<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>路飞爬虫 | Hanson&#39;s Blog</title>
<meta name="keywords" content="爬虫">
<meta name="description" content="爬虫再学习">
<meta name="author" content="
作者:&nbsp;Hanson">
<link rel="canonical" href="https://hanson00.github.io/posts/technology/python/%E8%B7%AF%E9%A3%9E%E7%88%AC%E8%99%AB/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.845a44c8f19c77e054f472b3a0bacb3d33effea14f20590af5e97de848f8ab8b.css" integrity="sha256-hFpEyPGcd&#43;BU9HKzoLrLPTPv/qFPIFkK9el96Ej4q4s=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://hanson00.github.io/posts/imgs/66.jpg">
<link rel="icon" type="image/png" sizes="16x16" href="https://hanson00.github.io/posts/imgs/favicon16x16.ico">
<link rel="icon" type="image/png" sizes="32x32" href="https://hanson00.github.io/posts/imgs/favicon32x32.ico">
<link rel="apple-touch-icon" href="https://hanson00.github.io/posts/imgs/66.jpg">
<link rel="mask-icon" href="https://hanson00.github.io/posts/imgs/66.jpg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="路飞爬虫" />
<meta property="og:description" content="爬虫再学习" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hanson00.github.io/posts/technology/python/%E8%B7%AF%E9%A3%9E%E7%88%AC%E8%99%AB/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-25T19:15:04&#43;08:00" />
<meta property="article:modified_time" content="2022-06-25T19:15:04&#43;08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="路飞爬虫"/>
<meta name="twitter:description" content="爬虫再学习"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://hanson00.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "💻技术类文章",
      "item": "https://hanson00.github.io/posts/technology/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Python文章",
      "item": "https://hanson00.github.io/posts/technology/python/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "路飞爬虫",
      "item": "https://hanson00.github.io/posts/technology/python/%E8%B7%AF%E9%A3%9E%E7%88%AC%E8%99%AB/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "路飞爬虫",
  "name": "路飞爬虫",
  "description": "爬虫再学习",
  "keywords": [
    "爬虫"
  ],
  "articleBody": "爬虫—路飞视频学习 爬虫如果出问题第一件事情查看请求头参数如：UA(User-Agent)\nPOST请求注意发送数据，如果是POST请求则要在请求中加入From Data\n数据解析：尽量使用re解析和xpath解析数据\n网页的渲染方式： 使用浏览器开发者工具和查看网页源代码可以看出为什么渲染方式\n 服务器渲染：在服务器那边就直接把数据和html结合在一起，统一返回给客户端(浏览器) 客户端渲染：客户端浏览器第一次请求时只要一个html骨架，待浏览器检查html时再第二次向服务器请求数据，并进行渲染【在网页源代码中看不到数据】|如果遇到客户端渲染的网页则要在抓包工具中(浏览器开发者工具)捕获需要的数据源在对该数据源的URL进行请求抓取  关于网页编码与解码的一些总结   在一般网页有给出自己给出编码字符集时可以观察编码后自行赋值或者自己编写正则表达式自己提取\n电影天堂项目体现\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53  # verify = false告诉网站不做校验忽略ssl，verify中文核实，校验 # request在发送请求时也会发送一个校验，发送一个证书 import re import requests #1.从电影天堂的首页爬取相关首页的内容 # 2.从相关内容中提取相关下载信息 url = \"https://dytt89.com/\" header = { \"User-Agent\": \"Mozilla / 5.0(Windows NT 10.0;Win64;x64) AppleWebKit / 537.36(KHTML, like Gecko) Chrome / 94.0.4606.71Safari / 537.36\" } # response = requests.get(url, headers=header, verify=False) response = requests.get(url, headers=header) #本次实验不需verify也可以获得信息 # 获取网页的编码方式,自己通过正则提取 charsetre = re.compile('charset=(?P.*?)\"', re.S) code1 = charsetre.search(response.text) code = code1.group(\"charset\") # print(code) #或者在爬取乱码网页后进行观察后自行赋值（直接自己赋值） response.encoding = code html = response.text #下面两行代码也可解决编码问题 # code = response.encoding # print(response.text.encode(code).decode(\"gb2312\")) # print(html) #提取首页中所需内容 redata = re.compile(R'2022必看热片.*?(?P.*?)', re.S) child_re = re.compile(R\".*?)'\", re.S) data = redata.finditer(html) for i in data: link = i.group(\"data1\") # print(link) #在提取的首页内容中进一步提取子页所需内容 child_href = child_re.finditer(link) child_url = '' for i in child_href: # print(i.group(\"href\")) child_url = url + i.group(\"href\").strip(\"/\") # print(child_url) child_response = requests.get(child_url, headers=header) child_response.encoding = code # print(child_response.text) child_html = child_response.text child_rename = re.compile(R'◎译　名　(?P.*?)\n.*?' R'.*?)\"', re.S) a =child_rename.finditer(child_html) for i in a: print(i.group(\"mname\")) print(i.group(\"load\")) response.close() print(\"爬取结束\")     案例2\n1 2 3 4 5 6 7 8 9  import requests heads = {\"User_Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.99 Safari/537.36\"} url1 = \"https://www.baidu.com\" request_data = requests.get(url=url1, headers=heads) code = request_data.encoding print(code) response = request_data.text.encode(code).decode(\"utf-8\") print(response) #response = request_data.text 有时可以直接无需转码或者有时候可以使用decode(\"gbk\")   requests get方式请求：\n1 2 3 4 5 6 7 8 9  import requests url = \"https://www.baidu.com/s?ie=UTF-8\u0026wd=%E5%91%A8%E6%9D%B0%E4%BC%A6\" headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36\" \" (KHTML, like Gecko) Chrome/97.0.4692.99 Safari/537.36\" } response = requests.get(url, headers=headers) print(response.text)   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  import requests if __name__ == '__main__': print('hello') # https://movie.douban.com/j/chart/top_list?type=24\u0026interval_id=100%3A90\u0026action=\u0026start=0\u0026limit=20 url = 'https://movie.douban.com/j/chart/top_list?' # 封装URL的参数 params = { 'type':24, 'interval_id':'100:90', 'action':'', 'start':0, 'limit':20, } headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36\" } response = requests.get(url=url, headers=headers, params=params) response.encoding = 'utf8' print(response.json())   post方式请求： post请求时需要查看网页的From data所需要的参数然后在填充后传入\n1 2 3 4 5 6 7 8 9 10 11  # post请求：百度翻译 import requests url = \"https://fanyi.baidu.com/sug\" ins = input(\"请输入你要翻译的词\") data = { \"kw\": ins } response = requests.post(url, data=data) print(response.json())   数据解析 三种解析方式：\n re解析(最快) bs4解析(便捷)在李巍爬虫学习中 xpath解析  re正则表达式 1 2 3 4 5 6 7 8 9 10 11 12  import re str = ''' 周杰伦 周杰伦2 周杰伦3 ''' # 使用 (?P正则) res = re.compile(R'.*?)\"(.*?)') result = res.finditer(str) for i in result: print(i.group('id'))   xPath解析   首先导入from lxml import etree etree才包括了xPath解析的功能\nxPath解析XML\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41  from lxml import etree xml = \"\"\"  1 野花遍地香 1.23 臭豆腐  周大枪 周芷若 周杰伦 蔡依林  nick惹了 nic惹了   22惹了    胖胖陈 胖胖不陈   \"\"\" tree = etree.XML(xml) #生成一个xPath解析的XML对象 # result = tree.xpath(\"/book\") #output:[] result = tree.xpath(\"/book/name\") #output:[] result = tree.xpath(\"/book/name/text()\") #output:['野花遍地香'] # 把后代(子孙节点的内容拿出来) result = tree.xpath(\"/book/author//nick/text()\") #output:['周大枪', '周芷若', '周杰伦', '蔡依林', 'nick惹了', '22惹了'] #*通配符 result = tree.xpath(\"/book/author/*/nick/text()\") #output:['nick惹了', '22惹了'] print(result)     xPath解析html\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57  from lxml import etree tree = etree.parse(\"ts.html\")\t# result = tree.xpath(\"/html\") #output:[] result = tree.xpath(\"/html/body/ul/li/a\") #output:[, , ] #xPath的索引是从第一个开始 result = tree.xpath(\"/html/body/ul/li[1]/a/text()\") #output:['百度'] #两种提取大炮的方法 result = tree.xpath(\"/html/body/ol/li[2]/a/text()\") #output:['大炮'] #@表示a里面的属性href是dapao的 #[@XXX=XXX] : 属性的筛选 result = tree.xpath(\"/html/body/ol/li/a[@href='dapao']/text()\") #output:['大炮'] result = tree.xpath(\"/html/body/ol/li\") #output: ['飞机'] #['大炮'] #['火车'] for i in result: a = i.xpath(\"./a/text()\") print(a) #拿到a里面的属性的值 result = tree.xpath(\"/html/body/ol/li/a/@href\") print(result) \"\"\"  Title    百度 谷歌 搜狗   飞机 大炮 火车  李嘉诚 胡辣汤   \"\"\"   xpath有时候返回的是一个列表注意了\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  from lxml import etree import requests if __name__ == '__main__': url = 'https://sc.chinaz.com/jianli/221025527710.htm' headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36\" } response = requests.get(url=url, headers=headers) response.encoding = \"utf-8\" html = etree.HTML(response.text) # 下面代码返回的是一个列表注意了 zip_url = html.xpath(\"//div[@class='clearfix mt20 downlist']//li[1]/a/@href\") # print(type(zip_url)) # zip_url:https://downsc.chinaz.net/Files/DownLoad/jianli/202210/zjianli596.rar response1 = requests.get(url=zip_url[0], headers=headers) with open('./1.zip', 'wb') as file: file.write(response1.content) response1.close()   xPath解析猪八戒网 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30  import requests from lxml import etree import csv baseurl = \"https://zhanjiang.zbj.com/search/f/?kw=saas\" headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36\" \" (KHTML, like Gecko) Chrome/97.0.4692.99 Safari/537.36\" } response = requests.get(baseurl, headers=headers) # print(response.text) html = etree.HTML(response.text) #相对解析 #拿到整个大的div的列表 divs = html.xpath(\"/html/body/div[6]/div/div/div[2]/div[5]/div[1]/div\") namelist = [] datalist = [] #在整个大的div里面选取要提取的数据 for i in divs: price = i.xpath(\"./div/div/a[2]/div[2]/div[1]/span[1]/text()\")[0].strip(\"¥\") title = \"saas\".join(i.xpath(\"./div/div/a[2]/div[2]/div[2]/p/text()\")) com_name = i.xpath(\"./div/div/a[1]/div[1]/p/text()\")[1].strip() place = i.xpath(\"./div/div/a[1]/div[1]/div/span/text()\")[0] datalist = [title, price, com_name, place] # print(com_name) with open(\"猪八戒.csv\", \"a+\") as csvfile: zwriter = csv.writer(csvfile, ) zwriter.writerow(datalist) response.close() print(\"爬取结束\")   防盗链-梨视频 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33  import requests #原始页面的链接，有需要替换的信息 url = \"https://www.pearvideo.com/video_1761797\" header = { \"User-Agent\": \"Mozilla / 5.0(Windows NT 10.0;Win64;x64) AppleWebKit / 537.36(KHTML, like Gecko) Chrome / 94.0.4606.71Safari / 537.36\", #防盗链：溯源1-》2-》3一样 'Referer': 'https://www.pearvideo.com/video_1761797' } #获取后面要用于替换的信息 conid = url.split(\"_\")[1] #从抓包工具中获取的url里面获取json，目的是要获得假的URL visit_url = f\"https://www.pearvideo.com/videoStatus.jsp?contId={conid}\u0026mrd=0.561999819571843\" response = requests.get(url=visit_url, headers=header) # print(response.json()) #在抓包工具中的链接里面获得假视频URL和假视频URL的信息用于替换 #'https://video.pearvideo.com/mp4/adshort/20220511/1652607901500-15877599_adpkg-ad_hd.mp4' flase_url = response.json()[\"videoInfo\"][\"videos\"][\"srcUrl\"] systemtime = response.json()['systemTime'] # print(systemtime) # print(flase_url) realurl = flase_url.replace(systemtime, f\"cont-{conid}\") print(realurl) #下载视频 with open(\"梨视频.mp4\", \"wb\") as f: f.write(requests.get(realurl).content) response.close() print(\"爬取结束\")   豆瓣小抓取 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30  import requests import re import csv url = \"https://movie.douban.com/top250?start=\" header = { \"User-Agent\": \"Mozilla / 5.0(Windows NT 10.0;Win64;x64) AppleWebKit / 537.36(KHTML, like Gecko) Chrome / 94.0.4606.71Safari / 537.36\" } req = requests.get(url, headers=header) response = req.text # print(response) res = re.compile(R'.*?(?P.*?)' R'.*?.*?\n(?P.*?)\u0026nbsp.*?' R'(?P.*?).*?' R'(?P\\d+)人评价', re.S) result = res.finditer(response) with open(\"lufeidouban.csv\", \"a\") as f: file_writer = csv.writer(f) for i in result: # print(i.group(\"name\")) # print(i.group(\"year\").strip()) # print(i.group(\"scroe\")) # print(i.group(\"people\")) #将数据保存成csv文件 dic = i.groupdict() dic[\"year\"] = dic[\"year\"].strip() file_writer.writerow(dic.values()) req.close() print(\"爬取结束\")    北京新发地抓取 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35  # coding:utf-8 # @Time : 2022/5/13 15:42 # @Author : 软件1194温铭军 # @file : beijing_xinfadi.py # $software : PyCharm import requests import csv #使用post请求时所要添加data请求参数,可以在浏览器开发者工具里面的From Data里面看到 url = \"http://www.xinfadi.com.cn/getPriceData.html\" headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36\" \" (KHTML, like Gecko) Chrome/97.0.4692.99 Safari/537.36\" } data= { 'limit': '', 'current': '', 'pubDateStartTime': '', 'pubDateEndTime': '', 'prodPcatid': '', 'prodCatid': '', 'prodName': '' } response = requests.post(url, headers=headers, data=data) result = response.json() ts = result[\"list\"] with open(\"北京新发地农产品数据.csv\", \"w\", newline='') as f: csvwriter = csv.DictWriter(f, fieldnames=['prodName', 'lowPrice', 'highPrice', 'avgPrice', 'place', 'unitInfo','pubDate'], extrasaction='ignore') csvwriter.writeheader() for i in range(len(ts)): csvwriter.writerow(ts[i]) response.close() print(\"爬取结束\")   电影天堂重复代码处理 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53  # coding:utf-8 # @Time : 2022/5/13 9:09 # @Author : 软件1194温铭军 # @file : dytt.py # $software : PyCharm # verify = false告诉网站不做校验忽略ssl，verify中文核实，校验 # request在发送请求时也会发送一个校验，发送一个证书 import re import requests url = \"https://dytt89.com/\" header = { \"User-Agent\": \"Mozilla / 5.0(Windows NT 10.0;Win64;x64) AppleWebKit / 537.36(KHTML, like Gecko) Chrome / 94.0.4606.71Safari / 537.36\" } def htmldata(url): \"\"\" 代替提取网页信息 :param url: :return: \"\"\" response = requests.get(url, headers=header) code1 = charsetre.search(response.text) code = code1.group(\"charset\") response.encoding = code html = response.text response.close() return html # 或者自己通过正则提取 charsetre = re.compile('charset=(?P.*?)\"', re.S) redata = re.compile(R'2022必看热片.*?(?P.*?)', re.S) child_re = re.compile(R\".*?)'\", re.S) data = redata.finditer(htmldata(url)) for i in data: link = i.group(\"data1\") # print(link) child_href = child_re.finditer(link) child_url = '' for i in child_href: # print(i.group(\"href\")) child_url = url + i.group(\"href\").strip(\"/\") # print(child_url) child_data = htmldata(child_url) child_rename = re.compile(R'◎译　名　(?P.*?)\n.*?' R'.*?)\"', re.S) a =child_rename.finditer(child_data) for i in a: print(i.group(\"mname\")) print(i.group(\"load\")) print(\"爬取结束\")   代理 代理：通过第三方的一个机器去发送请求（去网上找免费代理，或者找）\n综合训练-网易云音乐评论抓取 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132  # coding:utf-8 # @Time : 2022/5/16 10:07 # @file : 网易云音乐.py # $software : PyCharm #爬取网易云音乐评论 # 步骤： # 1.找到未加密的数据 # 2.想办法把参数按照网易云音乐本身的逻辑加密 # 3.请求到网易，拿到评论信息 # 加密参数 # params:就是encText # encSecKey:就是encSecKey from Crypto.Cipher import AES import requests import re import json from base64 import b64encode url = \"https://music.163.com/weapi/comment/resource/comments/get?csrf_token=\" #POST请求 headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36\" \" (KHTML, like Gecko) Chrome/97.0.4692.99 Safari/537.36\" } #找到了真正的参数，接下来还需要解密过程 data = { 'csrf_token': \"\", 'cursor': \"-1\", 'offset': \"0\", 'orderType': \"1\", 'pageNo': \"1\", 'pageSize': \"20\", 'rid': \"R_SO_4_441491828\", 'threadId': \"R_SO_4_441491828\" } #处理加密过程 #服务于windows.arXXX的加密过程 e = '010001' f = '00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7' g = '0CoJUm6Qyw8W8jud' i = 'LvjKmGgecBJv6kkF' #手动固定 #如果把i固定那么下面这个函数一定是固定的，由下面的c函数解出 def get_encSecKey(): return \"7c435414bc686e49dc26a57ffedbb80b320fd755755c5da8e72f416a61370039aa2d3fa333e54a6e7c9abe7f26faffa69d1721db76cb2e6f17d0393d4cfbc6176590909d027022c4e458aee2123c329b60e1e422beef0f8e39efad5014cbeab022199bc7e6c47a5d0bca5528f6c7946305ae019674309d562c69b39dde9ea429\" #字典不能加密，所以下面这个函数默认收到的是字符串 def get_params(data): \"\"\" 就是去还原下面的b的两次加密 h.encText = b(d, g), d是数据 g是密钥 g:固定值 '0CoJUm6Qyw8W8jud' h.encText = b(h.encText, i) :param data: :return: \"\"\" first = enc_params(data, g) second = enc_params(first, i) return second #返回的就是params #转换成16的长度为加密算法服务 def to_16(data): pad = 16 - len(data) % 16 data += chr(pad) *pad return data #第二个参数的加密算法 def enc_params(data, key): iv = '0102030405060708' data = to_16(data) aes = AES.new(key=key.encode(\"utf-8\"), IV=iv, mode=AES.MODE_CBC) #创建了一个加密工具 bs = aes.encrypt(data.encode(\"utf-8\")) #如果想要返回字符串还需要base64转码 return str(b64encode(bs), \"utf-8\") pass \"\"\" function a(a) { var d, e, b = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\", c = \"\"; for (d = 0; a  d; d += 1) #循环16次 e = Math.random() * b.length, #产生随机数 e = Math.floor(e), #取整 c += b.charAt(e); return c #返回一个16个字母 } function b(a, b) { a是要加密的内容 var c = CryptoJS.enc.Utf8.parse(b) c和b是一回事 , d = CryptoJS.enc.Utf8.parse(\"0102030405060708\") 偏移量 , e = CryptoJS.enc.Utf8.parse(a) e和a相同都是数据 , f = CryptoJS.AES.encrypt(e, c, { e是数据，c是 AES是加密算法自己查的话可以知道下面的东西 iv: d, 偏移量 mode: CryptoJS.mode.CBC 加密模式CBC 看完之后发现少了个密钥所以c(b)是密钥 }); return f.toString() } function c(a, b, c) { var d, e; return setMaxDigits(131), d = new RSAKeyPair(b,\"\",c), #RSA加密 e = encryptedString(d, a) } function d(d, e, f, g) { d：就是真实数据data,除了数据d是变的之外，其他都是不变的 var h = {}产生一个空对象 e：固定值 '010001' , i = a(16); i是一个16位数的随机字符串 f:超长定值 '00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7' h.encText = b(d, g), d是数据 g是密钥 g:固定值 '0CoJUm6Qyw8W8jud' h.encText = b(h.encText, i), i是密钥 #返回的就是加密数据param #如果i固定那么encSeckey就固定 h.encSecKey = c(i, e, f), i是一个16位数的随机字符串，ef是固定的值 #返回的就是加密参数encSecKey return h }windows.a = d加密参数的入口是d encText是通过两次加密得出第二个加密参数 \"\"\" response = requests.post(url, headers=headers, data={ \"params\":get_params(json.dumps(data)), \"encSecKey\":get_encSecKey() }) print(response.text) # list = response.json()['data']['hotComments'] # res = re.compile(r\"'content': '(.*?)',\") # # print(list[0]) # print(res.findall(str(list))) response.close() print(\"OVER!\")   [后续练习] 熟练使用浏览器开发者工具\n [附录] 使用.*?代替变化的内容，使用(.*?)代表需要提取的内容\n记得关闭请求\n",
  "wordCount" : "5600",
  "inLanguage": "en",
  "datePublished": "2022-06-25T19:15:04+08:00",
  "dateModified": "2022-06-25T19:15:04+08:00",
  "author":{
    "@type": "Person",
    "name": "Hanson"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://hanson00.github.io/posts/technology/python/%E8%B7%AF%E9%A3%9E%E7%88%AC%E8%99%AB/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Hanson's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://hanson00.github.io/posts/imgs/66.jpg"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://hanson00.github.io/" accesskey="h" title="Hanson&#39;s Blog (Alt + H)">Hanson&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://hanson00.github.io/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
            <li>
                <a href="https://hanson00.github.io/" title="🏠主页">
                    <span>🏠主页</span>
                </a>
            </li>
            <li>
                <a href="https://hanson00.github.io/posts" title="📚文章">
                    <span>📚文章</span>
                </a>
            </li>
            <li>
                <a href="https://hanson00.github.io/archives/" title="⏱时间轴">
                    <span>⏱时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://hanson00.github.io/tags" title="🔖标签">
                    <span>🔖标签</span>
                </a>
            </li>
            <li>
                <a href="https://hanson00.github.io/about" title="🙋🏻‍♂️关于">
                    <span>🙋🏻‍♂️关于</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">

  <header class="post-header">
    <div class="breadcrumbs"><a href="https://hanson00.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://hanson00.github.io/posts/">Posts</a>&nbsp;»&nbsp;<a href="https://hanson00.github.io/posts/technology/">💻技术类文章</a>&nbsp;»&nbsp;<a href="https://hanson00.github.io/posts/technology/python/">Python文章</a></div>
    <h1 class="post-title">
      路飞爬虫
    </h1>
    <div class="post-description">
      爬虫再学习
    </div>
    <div class="post-meta">










更新:&nbsp;2022-06-25&nbsp;|&nbsp;字数:&nbsp;5600字&nbsp;|&nbsp;时长: 12分钟&nbsp;|&nbsp;
作者:&nbsp;Hanson&nbsp;|&nbsp;标签: &nbsp;
      <ul class="post-tags-meta">
        <a href="https://hanson00.github.io/tags/%E7%88%AC%E8%99%AB/">爬虫</a>
      </ul>

      <span id="busuanzi_container_page_pv">
        &nbsp;| 访问: <span id="busuanzi_value_page_pv"></span>
      </span>

</div>
  </header> <aside id="toc-container" class="toc-container wide">
        <div class="toc">
            <details  open>
                <summary accesskey="c" title="(Alt + C)">
                    <span class="details">Table of Contents</span>
                </summary>

                <div class="inner"><ul>
                        <li>
                            <a href="#%e7%88%ac%e8%99%ab%e8%b7%af%e9%a3%9e%e8%a7%86%e9%a2%91%e5%ad%a6%e4%b9%a0" aria-label="爬虫—路飞视频学习">爬虫—路飞视频学习</a><ul>
                                    
                        <li>
                            <a href="#%e7%bd%91%e9%a1%b5%e7%9a%84%e6%b8%b2%e6%9f%93%e6%96%b9%e5%bc%8f" aria-label="网页的渲染方式：">网页的渲染方式：</a><ul>
                                    
                        <li>
                            <a href="#%e5%85%b3%e4%ba%8e%e7%bd%91%e9%a1%b5%e7%bc%96%e7%a0%81%e4%b8%8e%e8%a7%a3%e7%a0%81%e7%9a%84%e4%b8%80%e4%ba%9b%e6%80%bb%e7%bb%93" aria-label="关于网页编码与解码的一些总结">关于网页编码与解码的一些总结</a></li></ul>
                        </li>
                        <li>
                            <a href="#requests" aria-label="requests">requests</a></li>
                        <li>
                            <a href="#%e6%95%b0%e6%8d%ae%e8%a7%a3%e6%9e%90" aria-label="数据解析">数据解析</a><ul>
                                    
                        <li>
                            <a href="#re%e6%ad%a3%e5%88%99%e8%a1%a8%e8%be%be%e5%bc%8f" aria-label="re正则表达式">re正则表达式</a></li>
                        <li>
                            <a href="#xpath%e8%a7%a3%e6%9e%90" aria-label="xPath解析">xPath解析</a></li>
                        <li>
                            <a href="#xpath%e8%a7%a3%e6%9e%90%e7%8c%aa%e5%85%ab%e6%88%92%e7%bd%91" aria-label="xPath解析猪八戒网">xPath解析猪八戒网</a></li>
                        <li>
                            <a href="#%e9%98%b2%e7%9b%97%e9%93%be-%e6%a2%a8%e8%a7%86%e9%a2%91" aria-label="防盗链-梨视频">防盗链-梨视频</a></li>
                        <li>
                            <a href="#%e8%b1%86%e7%93%a3%e5%b0%8f%e6%8a%93%e5%8f%96" aria-label="豆瓣小抓取">豆瓣小抓取</a></li>
                        <li>
                            <a href="#%e5%8c%97%e4%ba%ac%e6%96%b0%e5%8f%91%e5%9c%b0%e6%8a%93%e5%8f%96" aria-label="北京新发地抓取">北京新发地抓取</a></li>
                        <li>
                            <a href="#%e7%94%b5%e5%bd%b1%e5%a4%a9%e5%a0%82%e9%87%8d%e5%a4%8d%e4%bb%a3%e7%a0%81%e5%a4%84%e7%90%86" aria-label="电影天堂重复代码处理">电影天堂重复代码处理</a></li></ul>
                        </li>
                        <li>
                            <a href="#%e4%bb%a3%e7%90%86" aria-label="代理">代理</a></li>
                        <li>
                            <a href="#%e7%bb%bc%e5%90%88%e8%ae%ad%e7%bb%83-%e7%bd%91%e6%98%93%e4%ba%91%e9%9f%b3%e4%b9%90%e8%af%84%e8%ae%ba%e6%8a%93%e5%8f%96" aria-label="综合训练-网易云音乐评论抓取">综合训练-网易云音乐评论抓取</a><ul>
                                    
                        <li>
                            <a href="#%e5%90%8e%e7%bb%ad%e7%bb%83%e4%b9%a0" aria-label="[后续练习]">[后续练习]</a></li>
                        <li>
                            <a href="#%e9%99%84%e5%bd%95" aria-label="[附录]">[附录]</a>
                        </li>
                    </ul>
                    </li>
                    </ul>
                    </li>
                    </ul>
                </div>
            </details>
        </div>
    </aside>
    <script>
        let activeElement;
        let elements;
        window.addEventListener('DOMContentLoaded', function (event) {
            checkTocPosition();

            elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
            
            activeElement = elements[0];
            const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
            document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
        }, false);

        window.addEventListener('resize', function (event) {
            checkTocPosition();
        }, false);

        window.addEventListener('scroll', () => {
            
            activeElement = Array.from(elements).find((element) => {
                if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                    (getOffsetTop(element) - window.pageYOffset) < window.innerHeight / 2) {
                    return element;
                }
            }) || activeElement

            elements.forEach(element => {
                const id = encodeURI(element.getAttribute('id')).toLowerCase();
                if (element === activeElement) {
                    document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
                } else {
                    document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
                }
            })
        }, false);

        const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
        const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
        const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

        function checkTocPosition() {
            const width = document.body.scrollWidth;

            if (width - main - (toc * 2) - (gap * 4) > 0) {
                document.getElementById("toc-container").classList.add("wide");
            } else {
                document.getElementById("toc-container").classList.remove("wide");
            }
        }

        function getOffsetTop(element) {
            if (!element.getClientRects().length) {
                return 0;
            }
            let rect = element.getBoundingClientRect();
            let win = element.ownerDocument.defaultView;
            return rect.top + win.pageYOffset;
        }
    </script>
  <div class="post-content"><h1 id="爬虫路飞视频学习">爬虫—路飞视频学习<a hidden class="anchor" aria-hidden="true" href="#爬虫路飞视频学习">#</a></h1>
<p>爬虫如果出问题第一件事情查看请求头参数如：<code>UA(User-Agent)</code></p>
<p>POST请求注意发送数据，如果是POST请求则要在请求中加入<code>From Data</code></p>
<p>数据解析：尽量使用re解析和xpath解析数据</p>
<h2 id="网页的渲染方式">网页的渲染方式：<a hidden class="anchor" aria-hidden="true" href="#网页的渲染方式">#</a></h2>
<p>使用浏览器开发者工具和查看网页源代码可以看出为什么渲染方式</p>
<ol>
<li>服务器渲染：在服务器那边就直接把数据和html结合在一起，统一返回给客户端(浏览器)</li>
<li>客户端渲染：客户端浏览器第一次请求时只要一个html骨架，待浏览器检查html时再第二次向服务器请求数据，并进行渲染【在网页源代码中看不到数据】|如果遇到客户端渲染的网页则要在抓包工具中(浏览器开发者工具)捕获需要的数据源在对该数据源的URL进行请求抓取</li>
</ol>
<h3 id="关于网页编码与解码的一些总结">关于网页编码与解码的一些总结<a hidden class="anchor" aria-hidden="true" href="#关于网页编码与解码的一些总结">#</a></h3>
<ol>
<li>
<p>在一般网页有给出自己给出编码字符集时可以观察编码后自行赋值或者自己编写正则表达式自己提取</p>
<p>电影天堂项目体现</p>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#0080ff;font-style:italic"># verify = false告诉网站不做校验忽略ssl，verify中文核实，校验</span>
<span style="color:#0080ff;font-style:italic"># request在发送请求时也会发送一个校验，发送一个证书</span>
<span style="color:#2c5dcd;font-weight:bold">import</span> re
<span style="color:#2c5dcd;font-weight:bold">import</span> requests
<span style="color:#0080ff;font-style:italic">#1.从电影天堂的首页爬取相关首页的内容</span>
<span style="color:#0080ff;font-style:italic"># 2.从相关内容中提取相关下载信息</span>
url <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#34;https://dytt89.com/&#34;</span>
header <span style="color:#2c5dcd">=</span> {
<span style="color:#0c6">&#34;User-Agent&#34;</span>: <span style="color:#0c6">&#34;Mozilla / 5.0(Windows NT 10.0;Win64;x64) AppleWebKit / 537.36(KHTML, like Gecko) Chrome / 94.0.4606.71Safari / 537.36&#34;</span>
}

<span style="color:#0080ff;font-style:italic"># response = requests.get(url, headers=header, verify=False)</span>
response <span style="color:#2c5dcd">=</span> requests<span style="color:#2c5dcd">.</span>get(url, headers<span style="color:#2c5dcd">=</span>header)    <span style="color:#0080ff;font-style:italic">#本次实验不需verify也可以获得信息</span>
<span style="color:#0080ff;font-style:italic"># 获取网页的编码方式,自己通过正则提取</span>
charsetre <span style="color:#2c5dcd">=</span> re<span style="color:#2c5dcd">.</span>compile(<span style="color:#0c6">&#39;charset=(?P&lt;charset&gt;.*?)&#34;&gt;&#39;</span>, re<span style="color:#2c5dcd">.</span>S)
code1 <span style="color:#2c5dcd">=</span> charsetre<span style="color:#2c5dcd">.</span>search(response<span style="color:#2c5dcd">.</span>text)
code <span style="color:#2c5dcd">=</span> code1<span style="color:#2c5dcd">.</span>group(<span style="color:#0c6">&#34;charset&#34;</span>)
<span style="color:#0080ff;font-style:italic"># print(code)</span>
<span style="color:#0080ff;font-style:italic">#或者在爬取乱码网页后进行观察后自行赋值（直接自己赋值）</span>
response<span style="color:#2c5dcd">.</span>encoding <span style="color:#2c5dcd">=</span> code
html <span style="color:#2c5dcd">=</span> response<span style="color:#2c5dcd">.</span>text

<span style="color:#0080ff;font-style:italic">#下面两行代码也可解决编码问题</span>
<span style="color:#0080ff;font-style:italic"># code = response.encoding</span>
<span style="color:#0080ff;font-style:italic"># print(response.text.encode(code).decode(&#34;gb2312&#34;))</span>

<span style="color:#0080ff;font-style:italic"># print(html)</span>
<span style="color:#0080ff;font-style:italic">#提取首页中所需内容</span>
redata <span style="color:#2c5dcd">=</span> re<span style="color:#2c5dcd">.</span>compile(<span style="color:#0c6">R</span><span style="color:#0c6">&#39;2022必看热片.*?&lt;ul&gt;(?P&lt;data1&gt;.*?)&lt;/ul&gt;&#39;</span>, re<span style="color:#2c5dcd">.</span>S)
child_re <span style="color:#2c5dcd">=</span> re<span style="color:#2c5dcd">.</span>compile(<span style="color:#0c6">R</span><span style="color:#0c6">&#34;&lt;a href=&#39;(?P&lt;href&gt;.*?)&#39;&#34;</span>, re<span style="color:#2c5dcd">.</span>S)
data <span style="color:#2c5dcd">=</span> redata<span style="color:#2c5dcd">.</span>finditer(html)
<span style="color:#2c5dcd;font-weight:bold">for</span> i <span style="color:#2c5dcd;font-weight:bold">in</span> data:
    link <span style="color:#2c5dcd">=</span> i<span style="color:#2c5dcd">.</span>group(<span style="color:#0c6">&#34;data1&#34;</span>)
    <span style="color:#0080ff;font-style:italic"># print(link)</span>
    <span style="color:#0080ff;font-style:italic">#在提取的首页内容中进一步提取子页所需内容</span>
    child_href <span style="color:#2c5dcd">=</span> child_re<span style="color:#2c5dcd">.</span>finditer(link)
    child_url <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#39;&#39;</span>
    <span style="color:#2c5dcd;font-weight:bold">for</span> i <span style="color:#2c5dcd;font-weight:bold">in</span> child_href:
        <span style="color:#0080ff;font-style:italic"># print(i.group(&#34;href&#34;))</span>
        child_url <span style="color:#2c5dcd">=</span> url <span style="color:#2c5dcd">+</span> i<span style="color:#2c5dcd">.</span>group(<span style="color:#0c6">&#34;href&#34;</span>)<span style="color:#2c5dcd">.</span>strip(<span style="color:#0c6">&#34;/&#34;</span>)
        <span style="color:#0080ff;font-style:italic"># print(child_url)</span>
        child_response <span style="color:#2c5dcd">=</span> requests<span style="color:#2c5dcd">.</span>get(child_url, headers<span style="color:#2c5dcd">=</span>header)
        child_response<span style="color:#2c5dcd">.</span>encoding <span style="color:#2c5dcd">=</span> code
        <span style="color:#0080ff;font-style:italic"># print(child_response.text)</span>
        child_html <span style="color:#2c5dcd">=</span> child_response<span style="color:#2c5dcd">.</span>text
        child_rename <span style="color:#2c5dcd">=</span> re<span style="color:#2c5dcd">.</span>compile(<span style="color:#0c6">R</span><span style="color:#0c6">&#39;◎译　　名　(?P&lt;mname&gt;.*?)&lt;br /&gt;.*?&#39;</span>
                                  <span style="color:#0c6">R</span><span style="color:#0c6">&#39;&lt;td style=&#34;WORD-WRAP: break-word&#34; bgcolor=&#34;#fdfddf&#34;&gt;&lt;a href=&#34;(?P&lt;load&gt;.*?)&#34;&#39;</span>, re<span style="color:#2c5dcd">.</span>S)
        a <span style="color:#2c5dcd">=</span>child_rename<span style="color:#2c5dcd">.</span>finditer(child_html)
        <span style="color:#2c5dcd;font-weight:bold">for</span> i <span style="color:#2c5dcd;font-weight:bold">in</span> a:
            <span style="color:#5918bb;font-weight:bold">print</span>(i<span style="color:#2c5dcd">.</span>group(<span style="color:#0c6">&#34;mname&#34;</span>))
            <span style="color:#5918bb;font-weight:bold">print</span>(i<span style="color:#2c5dcd">.</span>group(<span style="color:#0c6">&#34;load&#34;</span>))
response<span style="color:#2c5dcd">.</span>close()
<span style="color:#5918bb;font-weight:bold">print</span>(<span style="color:#0c6">&#34;爬取结束&#34;</span>)
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p>案例2</p>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#2c5dcd;font-weight:bold">import</span> requests
heads <span style="color:#2c5dcd">=</span> {<span style="color:#0c6">&#34;User_Agent&#34;</span>: <span style="color:#0c6">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.99 Safari/537.36&#34;</span>}
url1 <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#34;https://www.baidu.com&#34;</span>
request_data <span style="color:#2c5dcd">=</span> requests<span style="color:#2c5dcd">.</span>get(url<span style="color:#2c5dcd">=</span>url1, headers<span style="color:#2c5dcd">=</span>heads)
code <span style="color:#2c5dcd">=</span> request_data<span style="color:#2c5dcd">.</span>encoding
<span style="color:#5918bb;font-weight:bold">print</span>(code)
response <span style="color:#2c5dcd">=</span> request_data<span style="color:#2c5dcd">.</span>text<span style="color:#2c5dcd">.</span>encode(code)<span style="color:#2c5dcd">.</span>decode(<span style="color:#0c6">&#34;utf-8&#34;</span>)
<span style="color:#5918bb;font-weight:bold">print</span>(response)
<span style="color:#0080ff;font-style:italic">#response = request_data.text   有时可以直接无需转码或者有时候可以使用decode(&#34;gbk&#34;)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="requests">requests<a hidden class="anchor" aria-hidden="true" href="#requests">#</a></h2>
<p>get方式请求：</p>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#2c5dcd;font-weight:bold">import</span> requests

url <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#34;https://www.baidu.com/s?ie=UTF-8&amp;wd=</span><span style="color:#0c6">%E</span><span style="color:#0c6">5</span><span style="color:#0c6">%91%</span><span style="color:#0c6">A8</span><span style="color:#0c6">%E</span><span style="color:#0c6">6%9D%B0</span><span style="color:#0c6">%E</span><span style="color:#0c6">4%BC%A6&#34;</span>
headers <span style="color:#2c5dcd">=</span> {
<span style="color:#0c6">&#34;User-Agent&#34;</span>: <span style="color:#0c6">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#34;</span>
              <span style="color:#0c6">&#34; (KHTML, like Gecko) Chrome/97.0.4692.99 Safari/537.36&#34;</span>
}
response <span style="color:#2c5dcd">=</span> requests<span style="color:#2c5dcd">.</span>get(url, headers<span style="color:#2c5dcd">=</span>headers)
<span style="color:#5918bb;font-weight:bold">print</span>(response<span style="color:#2c5dcd">.</span>text)
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#2c5dcd;font-weight:bold">import</span> requests

<span style="color:#2c5dcd;font-weight:bold">if</span> __name__ <span style="color:#2c5dcd">==</span> <span style="color:#0c6">&#39;__main__&#39;</span>:
    <span style="color:#5918bb;font-weight:bold">print</span>(<span style="color:#0c6">&#39;hello&#39;</span>)
    <span style="color:#0080ff;font-style:italic"># https://movie.douban.com/j/chart/top_list?type=24&amp;interval_id=100%3A90&amp;action=&amp;start=0&amp;limit=20</span>
    url <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#39;https://movie.douban.com/j/chart/top_list?&#39;</span>
    <span style="color:#0080ff;font-style:italic"># 封装URL的参数</span>
    params <span style="color:#2c5dcd">=</span> {
    <span style="color:#0c6">&#39;type&#39;</span>:<span style="color:#5918bb;font-weight:bold">24</span>,
    <span style="color:#0c6">&#39;interval_id&#39;</span>:<span style="color:#0c6">&#39;100:90&#39;</span>,
    <span style="color:#0c6">&#39;action&#39;</span>:<span style="color:#0c6">&#39;&#39;</span>,
    <span style="color:#0c6">&#39;start&#39;</span>:<span style="color:#5918bb;font-weight:bold">0</span>,
    <span style="color:#0c6">&#39;limit&#39;</span>:<span style="color:#5918bb;font-weight:bold">20</span>,
    }
    headers <span style="color:#2c5dcd">=</span> {
        <span style="color:#0c6">&#34;User-Agent&#34;</span>: <span style="color:#0c6">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36&#34;</span>
    }
    response <span style="color:#2c5dcd">=</span> requests<span style="color:#2c5dcd">.</span>get(url<span style="color:#2c5dcd">=</span>url, headers<span style="color:#2c5dcd">=</span>headers, params<span style="color:#2c5dcd">=</span>params)
    response<span style="color:#2c5dcd">.</span>encoding <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#39;utf8&#39;</span>
    <span style="color:#5918bb;font-weight:bold">print</span>(response<span style="color:#2c5dcd">.</span>json())
</code></pre></td></tr></table>
</div>
</div><p>post方式请求：
post请求时需要查看网页的From data所需要的参数然后在填充后传入</p>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#0080ff;font-style:italic"># post请求：百度翻译</span>
<span style="color:#2c5dcd;font-weight:bold">import</span> requests

url <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#34;https://fanyi.baidu.com/sug&#34;</span>
ins <span style="color:#2c5dcd">=</span> <span style="color:#5918bb;font-weight:bold">input</span>(<span style="color:#0c6">&#34;请输入你要翻译的词&#34;</span>)
data <span style="color:#2c5dcd">=</span> {
    <span style="color:#0c6">&#34;kw&#34;</span>: ins
}

response <span style="color:#2c5dcd">=</span> requests<span style="color:#2c5dcd">.</span>post(url, data<span style="color:#2c5dcd">=</span>data)
<span style="color:#5918bb;font-weight:bold">print</span>(response<span style="color:#2c5dcd">.</span>json())
</code></pre></td></tr></table>
</div>
</div><h2 id="数据解析">数据解析<a hidden class="anchor" aria-hidden="true" href="#数据解析">#</a></h2>
<p>三种解析方式：</p>
<ol>
<li>re解析(最快)</li>
<li>bs4解析(便捷)在李巍爬虫学习中</li>
<li>xpath解析</li>
</ol>
<h3 id="re正则表达式">re正则表达式<a hidden class="anchor" aria-hidden="true" href="#re正则表达式">#</a></h3>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#2c5dcd;font-weight:bold">import</span> re
<span style="color:#5918bb;font-weight:bold">str</span> <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#39;&#39;&#39;
</span><span style="color:#0c6">&lt;div class=&#34;jay&#34;&gt;&lt;span id = &#34;1&#34;&gt;周杰伦&lt;/span&gt;&lt;/div&gt;
</span><span style="color:#0c6">&lt;div class=&#34;jay2&#34;&gt;&lt;span id = &#34;2&#34;&gt;周杰伦2&lt;/span&gt;&lt;/div&gt;
</span><span style="color:#0c6">&lt;div class=&#34;jay3&#34;&gt;&lt;span id = &#34;3&#34;&gt;周杰伦3&lt;/span&gt;&lt;/div&gt;
</span><span style="color:#0c6">&#39;&#39;&#39;</span>
<span style="color:#0080ff;font-style:italic"># 使用 (?P&lt;分组名&gt;正则)</span>
res <span style="color:#2c5dcd">=</span> re<span style="color:#2c5dcd">.</span>compile(<span style="color:#0c6">R</span><span style="color:#0c6">&#39;&lt;div class=&#34;(?P&lt;id&gt;.*?)&#34;&gt;&lt;span id = &#34;.*&#34;&gt;(.*?)&lt;/span&gt;&lt;/div&gt;&#39;</span>)
result <span style="color:#2c5dcd">=</span> res<span style="color:#2c5dcd">.</span>finditer(<span style="color:#5918bb;font-weight:bold">str</span>)

<span style="color:#2c5dcd;font-weight:bold">for</span> i <span style="color:#2c5dcd;font-weight:bold">in</span> result:
    <span style="color:#5918bb;font-weight:bold">print</span>(i<span style="color:#2c5dcd">.</span>group(<span style="color:#0c6">&#39;id&#39;</span>))
</code></pre></td></tr></table>
</div>
</div><h3 id="xpath解析">xPath解析<a hidden class="anchor" aria-hidden="true" href="#xpath解析">#</a></h3>
<ol>
<li>
<p>首先导入<code>from lxml import etree</code> etree才包括了xPath解析的功能</p>
<p><strong>xPath解析XML</strong></p>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#2c5dcd;font-weight:bold">from</span> lxml <span style="color:#2c5dcd;font-weight:bold">import</span> etree
xml <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#34;&#34;&#34;
</span><span style="color:#0c6">&lt;book&gt;
</span><span style="color:#0c6">    &lt;id&gt;1&lt;/id&gt;
</span><span style="color:#0c6">    &lt;name&gt;野花遍地香&lt;/name&gt;
</span><span style="color:#0c6">    &lt;price&gt;1.23&lt;/price&gt;
</span><span style="color:#0c6">    &lt;nick&gt;臭豆腐&lt;/nick&gt;
</span><span style="color:#0c6">    &lt;author&gt;
</span><span style="color:#0c6">        &lt;nick id=&#34;10086&#34;&gt;周大枪&lt;/nick&gt;
</span><span style="color:#0c6">        &lt;nick id=&#34;10010&#34;&gt;周芷若&lt;/nick&gt;
</span><span style="color:#0c6">        &lt;nick class=&#34;joy&#34;&gt;周杰伦&lt;/nick&gt;
</span><span style="color:#0c6">        &lt;nick class=&#34;jolin&#34;&gt;蔡依林&lt;/nick&gt;
</span><span style="color:#0c6">        &lt;div&gt;
</span><span style="color:#0c6">            &lt;nick&gt;nick惹了&lt;/nick&gt;
</span><span style="color:#0c6">            &lt;nic&gt;nic惹了&lt;/nic&gt;
</span><span style="color:#0c6">        &lt;/div&gt;
</span><span style="color:#0c6">        &lt;span&gt;
</span><span style="color:#0c6">            &lt;nick&gt;22惹了&lt;/nick&gt;
</span><span style="color:#0c6">        &lt;/span&gt;
</span><span style="color:#0c6">    &lt;/author&gt;
</span><span style="color:#0c6">
</span><span style="color:#0c6">    &lt;partner&gt;
</span><span style="color:#0c6">        &lt;nick id=&#34;ppc&#34;&gt;胖胖陈&lt;/nick&gt;
</span><span style="color:#0c6">        &lt;nick id=&#34;ppbc&#34;&gt;胖胖不陈&lt;/nick&gt;
</span><span style="color:#0c6">    &lt;/partner&gt;
</span><span style="color:#0c6">&lt;/book&gt;
</span><span style="color:#0c6">&#34;&#34;&#34;</span>

tree <span style="color:#2c5dcd">=</span> etree<span style="color:#2c5dcd">.</span>XML(xml)  <span style="color:#0080ff;font-style:italic">#生成一个xPath解析的XML对象</span>

<span style="color:#0080ff;font-style:italic"># result = tree.xpath(&#34;/book&#34;)    #output:[&lt;Element book at 0x183918b2f00&gt;]</span>
result <span style="color:#2c5dcd">=</span> tree<span style="color:#2c5dcd">.</span>xpath(<span style="color:#0c6">&#34;/book/name&#34;</span>)    <span style="color:#0080ff;font-style:italic">#output:[&lt;Element name at 0x21065d142c0&gt;]</span>
result <span style="color:#2c5dcd">=</span> tree<span style="color:#2c5dcd">.</span>xpath(<span style="color:#0c6">&#34;/book/name/text()&#34;</span>)    <span style="color:#0080ff;font-style:italic">#output:[&#39;野花遍地香&#39;]</span>

<span style="color:#0080ff;font-style:italic"># 把后代(子孙节点的内容拿出来)</span>
result <span style="color:#2c5dcd">=</span> tree<span style="color:#2c5dcd">.</span>xpath(<span style="color:#0c6">&#34;/book/author//nick/text()&#34;</span>)    <span style="color:#0080ff;font-style:italic">#output:[&#39;周大枪&#39;, &#39;周芷若&#39;, &#39;周杰伦&#39;, &#39;蔡依林&#39;, &#39;nick惹了&#39;, &#39;22惹了&#39;]</span>

<span style="color:#0080ff;font-style:italic">#*通配符</span>
result <span style="color:#2c5dcd">=</span> tree<span style="color:#2c5dcd">.</span>xpath(<span style="color:#0c6">&#34;/book/author/*/nick/text()&#34;</span>)    <span style="color:#0080ff;font-style:italic">#output:[&#39;nick惹了&#39;, &#39;22惹了&#39;]</span>

<span style="color:#5918bb;font-weight:bold">print</span>(result)
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p><strong>xPath解析html</strong></p>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#2c5dcd;font-weight:bold">from</span> lxml <span style="color:#2c5dcd;font-weight:bold">import</span> etree

tree <span style="color:#2c5dcd">=</span> etree<span style="color:#2c5dcd">.</span>parse(<span style="color:#0c6">&#34;ts.html&#34;</span>)	<span style="color:#0080ff;font-style:italic">#</span>

result <span style="color:#2c5dcd">=</span> tree<span style="color:#2c5dcd">.</span>xpath(<span style="color:#0c6">&#34;/html&#34;</span>)    <span style="color:#0080ff;font-style:italic">#output:[&lt;Element html at 0x1e6e3568880&gt;]</span>
result <span style="color:#2c5dcd">=</span> tree<span style="color:#2c5dcd">.</span>xpath(<span style="color:#0c6">&#34;/html/body/ul/li/a&#34;</span>)    <span style="color:#0080ff;font-style:italic">#output:[&lt;Element a at 0x1f354c57300&gt;, &lt;Element a at 0x1f354c57400&gt;, &lt;Element a at 0x1f354c573c0&gt;]</span>

<span style="color:#0080ff;font-style:italic">#xPath的索引是从第一个开始</span>
result <span style="color:#2c5dcd">=</span> tree<span style="color:#2c5dcd">.</span>xpath(<span style="color:#0c6">&#34;/html/body/ul/li[1]/a/text()&#34;</span>)    <span style="color:#0080ff;font-style:italic">#output:[&#39;百度&#39;]</span>

<span style="color:#0080ff;font-style:italic">#两种提取大炮的方法</span>
result <span style="color:#2c5dcd">=</span> tree<span style="color:#2c5dcd">.</span>xpath(<span style="color:#0c6">&#34;/html/body/ol/li[2]/a/text()&#34;</span>)    <span style="color:#0080ff;font-style:italic">#output:[&#39;大炮&#39;]</span>
<span style="color:#0080ff;font-style:italic">#@表示a里面的属性href是dapao的</span>
<span style="color:#0080ff;font-style:italic">#[@XXX=XXX] : 属性的筛选</span>
result <span style="color:#2c5dcd">=</span> tree<span style="color:#2c5dcd">.</span>xpath(<span style="color:#0c6">&#34;/html/body/ol/li/a[@href=&#39;dapao&#39;]/text()&#34;</span>)    <span style="color:#0080ff;font-style:italic">#output:[&#39;大炮&#39;]</span>


result <span style="color:#2c5dcd">=</span> tree<span style="color:#2c5dcd">.</span>xpath(<span style="color:#0c6">&#34;/html/body/ol/li&#34;</span>)    <span style="color:#0080ff;font-style:italic">#output:  [&#39;飞机&#39;]</span>
                                                    <span style="color:#0080ff;font-style:italic">#[&#39;大炮&#39;]</span>
                                                    <span style="color:#0080ff;font-style:italic">#[&#39;火车&#39;]</span>
<span style="color:#2c5dcd;font-weight:bold">for</span> i <span style="color:#2c5dcd;font-weight:bold">in</span> result:
    a <span style="color:#2c5dcd">=</span> i<span style="color:#2c5dcd">.</span>xpath(<span style="color:#0c6">&#34;./a/text()&#34;</span>)
    <span style="color:#5918bb;font-weight:bold">print</span>(a)

<span style="color:#0080ff;font-style:italic">#拿到a里面的属性的值</span>
result <span style="color:#2c5dcd">=</span> tree<span style="color:#2c5dcd">.</span>xpath(<span style="color:#0c6">&#34;/html/body/ol/li/a/@href&#34;</span>)

<span style="color:#5918bb;font-weight:bold">print</span>(result)



<span style="color:#0c6">&#34;&#34;&#34;
</span><span style="color:#0c6">&lt;!DOCTYPE html&gt;
</span><span style="color:#0c6">&lt;html lang=&#34;en&#34;&gt;
</span><span style="color:#0c6">
</span><span style="color:#0c6">&lt;head&gt;
</span><span style="color:#0c6">    &lt;meta charset=&#34;UTF-8&#34; /&gt;
</span><span style="color:#0c6">    &lt;title&gt;Title&lt;/title&gt;
</span><span style="color:#0c6">&lt;/head&gt;
</span><span style="color:#0c6">
</span><span style="color:#0c6">&lt;body&gt;
</span><span style="color:#0c6">    &lt;ul&gt;
</span><span style="color:#0c6">        &lt;li&gt;&lt;a href=&#34;http://www.baidu.com&#34;&gt;百度&lt;/a&gt;&lt;/li&gt;
</span><span style="color:#0c6">        &lt;li&gt;&lt;a href=&#34;http://www.google.com&#34;&gt;谷歌&lt;/a&gt;&lt;/li&gt;
</span><span style="color:#0c6">        &lt;li&gt;&lt;a href=&#34;http://www.sogou.com&#34;&gt;搜狗&lt;/a&gt;&lt;/li&gt;
</span><span style="color:#0c6">    &lt;/ul&gt;
</span><span style="color:#0c6">    &lt;ol&gt;
</span><span style="color:#0c6">        &lt;li&gt;&lt;a href=&#34;feiji&#34;&gt;飞机&lt;/a&gt;&lt;/li&gt;
</span><span style="color:#0c6">        &lt;li&gt;&lt;a href=&#34;dapao&#34;&gt;大炮&lt;/a&gt;&lt;/li&gt;
</span><span style="color:#0c6">        &lt;li&gt;&lt;a href=&#34;huoche&#34;&gt;火车&lt;/a&gt;&lt;/li&gt;
</span><span style="color:#0c6">    &lt;/ol&gt;
</span><span style="color:#0c6">    &lt;div class=&#34;job&#34;&gt;李嘉诚&lt;/div&gt;
</span><span style="color:#0c6">    &lt;div class=&#34;common&#34;&gt;胡辣汤&lt;/div&gt;
</span><span style="color:#0c6">&lt;/body&gt;
</span><span style="color:#0c6">
</span><span style="color:#0c6">&lt;/html&gt;
</span><span style="color:#0c6">&#34;&#34;&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>xpath有时候返回的是一个列表注意了</strong></p>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#2c5dcd;font-weight:bold">from</span> lxml <span style="color:#2c5dcd;font-weight:bold">import</span> etree
<span style="color:#2c5dcd;font-weight:bold">import</span> requests

<span style="color:#2c5dcd;font-weight:bold">if</span> __name__ <span style="color:#2c5dcd">==</span> <span style="color:#0c6">&#39;__main__&#39;</span>:
    url <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#39;https://sc.chinaz.com/jianli/221025527710.htm&#39;</span>

    headers <span style="color:#2c5dcd">=</span> {
        <span style="color:#0c6">&#34;User-Agent&#34;</span>: <span style="color:#0c6">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36&#34;</span>
    }
    response <span style="color:#2c5dcd">=</span> requests<span style="color:#2c5dcd">.</span>get(url<span style="color:#2c5dcd">=</span>url, headers<span style="color:#2c5dcd">=</span>headers)
    response<span style="color:#2c5dcd">.</span>encoding <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#34;utf-8&#34;</span>

    html <span style="color:#2c5dcd">=</span> etree<span style="color:#2c5dcd">.</span>HTML(response<span style="color:#2c5dcd">.</span>text)
    <span style="color:#0080ff;font-style:italic"># 下面代码返回的是一个列表注意了</span>
    zip_url <span style="color:#2c5dcd">=</span> html<span style="color:#2c5dcd">.</span>xpath(<span style="color:#0c6">&#34;//div[@class=&#39;clearfix mt20 downlist&#39;]//li[1]/a/@href&#34;</span>)
    <span style="color:#0080ff;font-style:italic"># print(type(zip_url))</span>
    <span style="color:#0080ff;font-style:italic"># zip_url:https://downsc.chinaz.net/Files/DownLoad/jianli/202210/zjianli596.rar</span>
    response1 <span style="color:#2c5dcd">=</span> requests<span style="color:#2c5dcd">.</span>get(url<span style="color:#2c5dcd">=</span>zip_url[<span style="color:#5918bb;font-weight:bold">0</span>], headers<span style="color:#2c5dcd">=</span>headers)
    <span style="color:#2c5dcd;font-weight:bold">with</span> <span style="color:#5918bb;font-weight:bold">open</span>(<span style="color:#0c6">&#39;./1.zip&#39;</span>, <span style="color:#0c6">&#39;wb&#39;</span>) <span style="color:#2c5dcd;font-weight:bold">as</span> file:
        file<span style="color:#2c5dcd">.</span>write(response1<span style="color:#2c5dcd">.</span>content)
    response1<span style="color:#2c5dcd">.</span>close()
</code></pre></td></tr></table>
</div>
</div><h3 id="xpath解析猪八戒网">xPath解析猪八戒网<a hidden class="anchor" aria-hidden="true" href="#xpath解析猪八戒网">#</a></h3>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#2c5dcd;font-weight:bold">import</span> requests
<span style="color:#2c5dcd;font-weight:bold">from</span> lxml <span style="color:#2c5dcd;font-weight:bold">import</span> etree
<span style="color:#2c5dcd;font-weight:bold">import</span> csv
baseurl <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#34;https://zhanjiang.zbj.com/search/f/?kw=saas&#34;</span>
headers <span style="color:#2c5dcd">=</span> {
<span style="color:#0c6">&#34;User-Agent&#34;</span>: <span style="color:#0c6">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#34;</span>
              <span style="color:#0c6">&#34; (KHTML, like Gecko) Chrome/97.0.4692.99 Safari/537.36&#34;</span>
}
response <span style="color:#2c5dcd">=</span> requests<span style="color:#2c5dcd">.</span>get(baseurl, headers<span style="color:#2c5dcd">=</span>headers)
<span style="color:#0080ff;font-style:italic"># print(response.text)</span>

html <span style="color:#2c5dcd">=</span> etree<span style="color:#2c5dcd">.</span>HTML(response<span style="color:#2c5dcd">.</span>text)
<span style="color:#0080ff;font-style:italic">#相对解析</span>
<span style="color:#0080ff;font-style:italic">#拿到整个大的div的列表</span>
divs <span style="color:#2c5dcd">=</span> html<span style="color:#2c5dcd">.</span>xpath(<span style="color:#0c6">&#34;/html/body/div[6]/div/div/div[2]/div[5]/div[1]/div&#34;</span>)
namelist <span style="color:#2c5dcd">=</span> []
datalist <span style="color:#2c5dcd">=</span> []
<span style="color:#0080ff;font-style:italic">#在整个大的div里面选取要提取的数据</span>
<span style="color:#2c5dcd;font-weight:bold">for</span> i <span style="color:#2c5dcd;font-weight:bold">in</span> divs:
    price <span style="color:#2c5dcd">=</span> i<span style="color:#2c5dcd">.</span>xpath(<span style="color:#0c6">&#34;./div/div/a[2]/div[2]/div[1]/span[1]/text()&#34;</span>)[<span style="color:#5918bb;font-weight:bold">0</span>]<span style="color:#2c5dcd">.</span>strip(<span style="color:#0c6">&#34;¥&#34;</span>)
    title <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#34;saas&#34;</span><span style="color:#2c5dcd">.</span>join(i<span style="color:#2c5dcd">.</span>xpath(<span style="color:#0c6">&#34;./div/div/a[2]/div[2]/div[2]/p/text()&#34;</span>))
    com_name <span style="color:#2c5dcd">=</span> i<span style="color:#2c5dcd">.</span>xpath(<span style="color:#0c6">&#34;./div/div/a[1]/div[1]/p/text()&#34;</span>)[<span style="color:#5918bb;font-weight:bold">1</span>]<span style="color:#2c5dcd">.</span>strip()
    place <span style="color:#2c5dcd">=</span> i<span style="color:#2c5dcd">.</span>xpath(<span style="color:#0c6">&#34;./div/div/a[1]/div[1]/div/span/text()&#34;</span>)[<span style="color:#5918bb;font-weight:bold">0</span>]
    datalist <span style="color:#2c5dcd">=</span> [title, price, com_name, place]
    <span style="color:#0080ff;font-style:italic"># print(com_name)</span>
    <span style="color:#2c5dcd;font-weight:bold">with</span> <span style="color:#5918bb;font-weight:bold">open</span>(<span style="color:#0c6">&#34;猪八戒.csv&#34;</span>, <span style="color:#0c6">&#34;a+&#34;</span>) <span style="color:#2c5dcd;font-weight:bold">as</span> csvfile:
        zwriter <span style="color:#2c5dcd">=</span> csv<span style="color:#2c5dcd">.</span>writer(csvfile, )
        zwriter<span style="color:#2c5dcd">.</span>writerow(datalist)
response<span style="color:#2c5dcd">.</span>close()
<span style="color:#5918bb;font-weight:bold">print</span>(<span style="color:#0c6">&#34;爬取结束&#34;</span>)
</code></pre></td></tr></table>
</div>
</div><h3 id="防盗链-梨视频">防盗链-梨视频<a hidden class="anchor" aria-hidden="true" href="#防盗链-梨视频">#</a></h3>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#2c5dcd;font-weight:bold">import</span> requests

<span style="color:#0080ff;font-style:italic">#原始页面的链接，有需要替换的信息</span>
url <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#34;https://www.pearvideo.com/video_1761797&#34;</span>
header <span style="color:#2c5dcd">=</span> {
<span style="color:#0c6">&#34;User-Agent&#34;</span>: <span style="color:#0c6">&#34;Mozilla / 5.0(Windows NT 10.0;Win64;x64) AppleWebKit / 537.36(KHTML, like Gecko) Chrome / 94.0.4606.71Safari / 537.36&#34;</span>,
<span style="color:#0080ff;font-style:italic">#防盗链：溯源1-》2-》3一样</span>
<span style="color:#0c6">&#39;Referer&#39;</span>: <span style="color:#0c6">&#39;https://www.pearvideo.com/video_1761797&#39;</span>
}

<span style="color:#0080ff;font-style:italic">#获取后面要用于替换的信息</span>
conid <span style="color:#2c5dcd">=</span> url<span style="color:#2c5dcd">.</span>split(<span style="color:#0c6">&#34;_&#34;</span>)[<span style="color:#5918bb;font-weight:bold">1</span>]

<span style="color:#0080ff;font-style:italic">#从抓包工具中获取的url里面获取json，目的是要获得假的URL</span>
visit_url <span style="color:#2c5dcd">=</span> <span style="color:#0c6">f</span><span style="color:#0c6">&#34;https://www.pearvideo.com/videoStatus.jsp?contId=</span><span style="color:#0c6">{</span>conid<span style="color:#0c6">}</span><span style="color:#0c6">&amp;mrd=0.561999819571843&#34;</span>
response <span style="color:#2c5dcd">=</span> requests<span style="color:#2c5dcd">.</span>get(url<span style="color:#2c5dcd">=</span>visit_url, headers<span style="color:#2c5dcd">=</span>header)
<span style="color:#0080ff;font-style:italic"># print(response.json())</span>

<span style="color:#0080ff;font-style:italic">#在抓包工具中的链接里面获得假视频URL和假视频URL的信息用于替换</span>
<span style="color:#0080ff;font-style:italic">#&#39;https://video.pearvideo.com/mp4/adshort/20220511/1652607901500-15877599_adpkg-ad_hd.mp4&#39;</span>
flase_url <span style="color:#2c5dcd">=</span> response<span style="color:#2c5dcd">.</span>json()[<span style="color:#0c6">&#34;videoInfo&#34;</span>][<span style="color:#0c6">&#34;videos&#34;</span>][<span style="color:#0c6">&#34;srcUrl&#34;</span>]
systemtime <span style="color:#2c5dcd">=</span> response<span style="color:#2c5dcd">.</span>json()[<span style="color:#0c6">&#39;systemTime&#39;</span>]
<span style="color:#0080ff;font-style:italic"># print(systemtime)</span>
<span style="color:#0080ff;font-style:italic"># print(flase_url)</span>
realurl <span style="color:#2c5dcd">=</span> flase_url<span style="color:#2c5dcd">.</span>replace(systemtime, <span style="color:#0c6">f</span><span style="color:#0c6">&#34;cont-</span><span style="color:#0c6">{</span>conid<span style="color:#0c6">}</span><span style="color:#0c6">&#34;</span>)
<span style="color:#5918bb;font-weight:bold">print</span>(realurl)

<span style="color:#0080ff;font-style:italic">#下载视频</span>
<span style="color:#2c5dcd;font-weight:bold">with</span> <span style="color:#5918bb;font-weight:bold">open</span>(<span style="color:#0c6">&#34;梨视频.mp4&#34;</span>, <span style="color:#0c6">&#34;wb&#34;</span>) <span style="color:#2c5dcd;font-weight:bold">as</span> f:
    f<span style="color:#2c5dcd">.</span>write(requests<span style="color:#2c5dcd">.</span>get(realurl)<span style="color:#2c5dcd">.</span>content)

response<span style="color:#2c5dcd">.</span>close()
<span style="color:#5918bb;font-weight:bold">print</span>(<span style="color:#0c6">&#34;爬取结束&#34;</span>)
</code></pre></td></tr></table>
</div>
</div><h3 id="豆瓣小抓取">豆瓣小抓取<a hidden class="anchor" aria-hidden="true" href="#豆瓣小抓取">#</a></h3>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#2c5dcd;font-weight:bold">import</span> requests
<span style="color:#2c5dcd;font-weight:bold">import</span> re
<span style="color:#2c5dcd;font-weight:bold">import</span> csv
url <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#34;https://movie.douban.com/top250?start=&#34;</span>
header <span style="color:#2c5dcd">=</span> {
<span style="color:#0c6">&#34;User-Agent&#34;</span>: <span style="color:#0c6">&#34;Mozilla / 5.0(Windows NT 10.0;Win64;x64) AppleWebKit / 537.36(KHTML, like Gecko) Chrome / 94.0.4606.71Safari / 537.36&#34;</span>
}
req <span style="color:#2c5dcd">=</span> requests<span style="color:#2c5dcd">.</span>get(url, headers<span style="color:#2c5dcd">=</span>header)
response <span style="color:#2c5dcd">=</span> req<span style="color:#2c5dcd">.</span>text
<span style="color:#0080ff;font-style:italic"># print(response)</span>
res <span style="color:#2c5dcd">=</span> re<span style="color:#2c5dcd">.</span>compile(<span style="color:#0c6">R</span><span style="color:#0c6">&#39;&lt;div class=&#34;hd&#34;&gt;.*?&lt;span class=&#34;title&#34;&gt;(?P&lt;name&gt;.*?)&#39;</span>
                 <span style="color:#0c6">R</span><span style="color:#0c6">&#39;&lt;/span&gt;.*?&lt;p class=&#34;&#34;&gt;.*?&lt;br&gt;(?P&lt;year&gt;.*?)&amp;nbsp.*?&#39;</span>
                 <span style="color:#0c6">R</span><span style="color:#0c6">&#39;&lt;span class=&#34;rating_num&#34; property=&#34;v:average&#34;&gt;(?P&lt;scroe&gt;.*?)&lt;/span&gt;.*?&#39;</span>
                 <span style="color:#0c6">R</span><span style="color:#0c6">&#39;&lt;span&gt;(?P&lt;people&gt;\d+)人评价&lt;/span&gt;&#39;</span>, re<span style="color:#2c5dcd">.</span>S)
result <span style="color:#2c5dcd">=</span> res<span style="color:#2c5dcd">.</span>finditer(response)
<span style="color:#2c5dcd;font-weight:bold">with</span> <span style="color:#5918bb;font-weight:bold">open</span>(<span style="color:#0c6">&#34;lufeidouban.csv&#34;</span>, <span style="color:#0c6">&#34;a&#34;</span>) <span style="color:#2c5dcd;font-weight:bold">as</span> f:
    file_writer <span style="color:#2c5dcd">=</span> csv<span style="color:#2c5dcd">.</span>writer(f)
    <span style="color:#2c5dcd;font-weight:bold">for</span> i <span style="color:#2c5dcd;font-weight:bold">in</span> result:
        <span style="color:#0080ff;font-style:italic"># print(i.group(&#34;name&#34;))</span>
        <span style="color:#0080ff;font-style:italic"># print(i.group(&#34;year&#34;).strip())</span>
        <span style="color:#0080ff;font-style:italic"># print(i.group(&#34;scroe&#34;))</span>
        <span style="color:#0080ff;font-style:italic"># print(i.group(&#34;people&#34;))</span>

        <span style="color:#0080ff;font-style:italic">#将数据保存成csv文件</span>
        dic <span style="color:#2c5dcd">=</span> i<span style="color:#2c5dcd">.</span>groupdict()
        dic[<span style="color:#0c6">&#34;year&#34;</span>] <span style="color:#2c5dcd">=</span> dic[<span style="color:#0c6">&#34;year&#34;</span>]<span style="color:#2c5dcd">.</span>strip()
        file_writer<span style="color:#2c5dcd">.</span>writerow(dic<span style="color:#2c5dcd">.</span>values())

req<span style="color:#2c5dcd">.</span>close()
<span style="color:#5918bb;font-weight:bold">print</span>(<span style="color:#0c6">&#34;爬取结束&#34;</span>)
</code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="北京新发地抓取">北京新发地抓取<a hidden class="anchor" aria-hidden="true" href="#北京新发地抓取">#</a></h3>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#0080ff;font-style:italic"># coding:utf-8</span>
<span style="color:#0080ff;font-style:italic"># @Time : 2022/5/13 15:42</span>
<span style="color:#0080ff;font-style:italic"># @Author : 软件1194温铭军</span>
<span style="color:#0080ff;font-style:italic"># @file : beijing_xinfadi.py</span>
<span style="color:#0080ff;font-style:italic"># $software : PyCharm</span>
<span style="color:#2c5dcd;font-weight:bold">import</span> requests
<span style="color:#2c5dcd;font-weight:bold">import</span> csv
<span style="color:#0080ff;font-style:italic">#使用post请求时所要添加data请求参数,可以在浏览器开发者工具里面的From Data里面看到</span>
url <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#34;http://www.xinfadi.com.cn/getPriceData.html&#34;</span>
headers <span style="color:#2c5dcd">=</span> {
<span style="color:#0c6">&#34;User-Agent&#34;</span>: <span style="color:#0c6">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#34;</span>
              <span style="color:#0c6">&#34; (KHTML, like Gecko) Chrome/97.0.4692.99 Safari/537.36&#34;</span>
}
data<span style="color:#2c5dcd">=</span> {
<span style="color:#0c6">&#39;limit&#39;</span>: <span style="color:#0c6">&#39;&#39;</span>,
<span style="color:#0c6">&#39;current&#39;</span>: <span style="color:#0c6">&#39;&#39;</span>,
<span style="color:#0c6">&#39;pubDateStartTime&#39;</span>: <span style="color:#0c6">&#39;&#39;</span>,
<span style="color:#0c6">&#39;pubDateEndTime&#39;</span>: <span style="color:#0c6">&#39;&#39;</span>,
<span style="color:#0c6">&#39;prodPcatid&#39;</span>: <span style="color:#0c6">&#39;&#39;</span>,
<span style="color:#0c6">&#39;prodCatid&#39;</span>: <span style="color:#0c6">&#39;&#39;</span>,
<span style="color:#0c6">&#39;prodName&#39;</span>: <span style="color:#0c6">&#39;&#39;</span>
}
response <span style="color:#2c5dcd">=</span> requests<span style="color:#2c5dcd">.</span>post(url, headers<span style="color:#2c5dcd">=</span>headers, data<span style="color:#2c5dcd">=</span>data)
result <span style="color:#2c5dcd">=</span> response<span style="color:#2c5dcd">.</span>json()
ts <span style="color:#2c5dcd">=</span> result[<span style="color:#0c6">&#34;list&#34;</span>]

<span style="color:#2c5dcd;font-weight:bold">with</span> <span style="color:#5918bb;font-weight:bold">open</span>(<span style="color:#0c6">&#34;北京新发地农产品数据.csv&#34;</span>, <span style="color:#0c6">&#34;w&#34;</span>, newline<span style="color:#2c5dcd">=</span><span style="color:#0c6">&#39;&#39;</span>) <span style="color:#2c5dcd;font-weight:bold">as</span> f:
    csvwriter <span style="color:#2c5dcd">=</span> csv<span style="color:#2c5dcd">.</span>DictWriter(f, fieldnames<span style="color:#2c5dcd">=</span>[<span style="color:#0c6">&#39;prodName&#39;</span>, <span style="color:#0c6">&#39;lowPrice&#39;</span>, <span style="color:#0c6">&#39;highPrice&#39;</span>, <span style="color:#0c6">&#39;avgPrice&#39;</span>, <span style="color:#0c6">&#39;place&#39;</span>, <span style="color:#0c6">&#39;unitInfo&#39;</span>,<span style="color:#0c6">&#39;pubDate&#39;</span>],
                               extrasaction<span style="color:#2c5dcd">=</span><span style="color:#0c6">&#39;ignore&#39;</span>)
    csvwriter<span style="color:#2c5dcd">.</span>writeheader()
    <span style="color:#2c5dcd;font-weight:bold">for</span> i <span style="color:#2c5dcd;font-weight:bold">in</span> <span style="color:#5918bb;font-weight:bold">range</span>(<span style="color:#5918bb;font-weight:bold">len</span>(ts)):
        csvwriter<span style="color:#2c5dcd">.</span>writerow(ts[i])

response<span style="color:#2c5dcd">.</span>close()
<span style="color:#5918bb;font-weight:bold">print</span>(<span style="color:#0c6">&#34;爬取结束&#34;</span>)
</code></pre></td></tr></table>
</div>
</div><h3 id="电影天堂重复代码处理">电影天堂重复代码处理<a hidden class="anchor" aria-hidden="true" href="#电影天堂重复代码处理">#</a></h3>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#0080ff;font-style:italic"># coding:utf-8</span>
<span style="color:#0080ff;font-style:italic"># @Time : 2022/5/13 9:09</span>
<span style="color:#0080ff;font-style:italic"># @Author : 软件1194温铭军</span>
<span style="color:#0080ff;font-style:italic"># @file : dytt.py</span>
<span style="color:#0080ff;font-style:italic"># $software : PyCharm</span>
<span style="color:#0080ff;font-style:italic"># verify = false告诉网站不做校验忽略ssl，verify中文核实，校验</span>
<span style="color:#0080ff;font-style:italic"># request在发送请求时也会发送一个校验，发送一个证书</span>
<span style="color:#2c5dcd;font-weight:bold">import</span> re

<span style="color:#2c5dcd;font-weight:bold">import</span> requests
url <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#34;https://dytt89.com/&#34;</span>
header <span style="color:#2c5dcd">=</span> {
<span style="color:#0c6">&#34;User-Agent&#34;</span>: <span style="color:#0c6">&#34;Mozilla / 5.0(Windows NT 10.0;Win64;x64) AppleWebKit / 537.36(KHTML, like Gecko) Chrome / 94.0.4606.71Safari / 537.36&#34;</span>
}

<span style="color:#2c5dcd;font-weight:bold">def</span> <span style="color:#ff8000;font-weight:bold">htmldata</span>(url):
    <span style="color:#0c6">&#34;&#34;&#34;
</span><span style="color:#0c6">    代替提取网页信息
</span><span style="color:#0c6">    :param url:
</span><span style="color:#0c6">    :return:
</span><span style="color:#0c6">    &#34;&#34;&#34;</span>
    response <span style="color:#2c5dcd">=</span> requests<span style="color:#2c5dcd">.</span>get(url, headers<span style="color:#2c5dcd">=</span>header)
    code1 <span style="color:#2c5dcd">=</span> charsetre<span style="color:#2c5dcd">.</span>search(response<span style="color:#2c5dcd">.</span>text)
    code <span style="color:#2c5dcd">=</span> code1<span style="color:#2c5dcd">.</span>group(<span style="color:#0c6">&#34;charset&#34;</span>)
    response<span style="color:#2c5dcd">.</span>encoding <span style="color:#2c5dcd">=</span> code
    html <span style="color:#2c5dcd">=</span> response<span style="color:#2c5dcd">.</span>text
    response<span style="color:#2c5dcd">.</span>close()
    <span style="color:#2c5dcd;font-weight:bold">return</span> html

<span style="color:#0080ff;font-style:italic"># 或者自己通过正则提取</span>
charsetre <span style="color:#2c5dcd">=</span> re<span style="color:#2c5dcd">.</span>compile(<span style="color:#0c6">&#39;charset=(?P&lt;charset&gt;.*?)&#34;&gt;&#39;</span>, re<span style="color:#2c5dcd">.</span>S)

redata <span style="color:#2c5dcd">=</span> re<span style="color:#2c5dcd">.</span>compile(<span style="color:#0c6">R</span><span style="color:#0c6">&#39;2022必看热片.*?&lt;ul&gt;(?P&lt;data1&gt;.*?)&lt;/ul&gt;&#39;</span>, re<span style="color:#2c5dcd">.</span>S)
child_re <span style="color:#2c5dcd">=</span> re<span style="color:#2c5dcd">.</span>compile(<span style="color:#0c6">R</span><span style="color:#0c6">&#34;&lt;a href=&#39;(?P&lt;href&gt;.*?)&#39;&#34;</span>, re<span style="color:#2c5dcd">.</span>S)
data <span style="color:#2c5dcd">=</span> redata<span style="color:#2c5dcd">.</span>finditer(htmldata(url))
<span style="color:#2c5dcd;font-weight:bold">for</span> i <span style="color:#2c5dcd;font-weight:bold">in</span> data:
    link <span style="color:#2c5dcd">=</span> i<span style="color:#2c5dcd">.</span>group(<span style="color:#0c6">&#34;data1&#34;</span>)
    <span style="color:#0080ff;font-style:italic"># print(link)</span>
    child_href <span style="color:#2c5dcd">=</span> child_re<span style="color:#2c5dcd">.</span>finditer(link)
    child_url <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#39;&#39;</span>
    <span style="color:#2c5dcd;font-weight:bold">for</span> i <span style="color:#2c5dcd;font-weight:bold">in</span> child_href:
        <span style="color:#0080ff;font-style:italic"># print(i.group(&#34;href&#34;))</span>
        child_url <span style="color:#2c5dcd">=</span> url <span style="color:#2c5dcd">+</span> i<span style="color:#2c5dcd">.</span>group(<span style="color:#0c6">&#34;href&#34;</span>)<span style="color:#2c5dcd">.</span>strip(<span style="color:#0c6">&#34;/&#34;</span>)
        <span style="color:#0080ff;font-style:italic"># print(child_url)</span>
        child_data <span style="color:#2c5dcd">=</span> htmldata(child_url)
        child_rename <span style="color:#2c5dcd">=</span> re<span style="color:#2c5dcd">.</span>compile(<span style="color:#0c6">R</span><span style="color:#0c6">&#39;◎译　　名　(?P&lt;mname&gt;.*?)&lt;br /&gt;.*?&#39;</span>
                                  <span style="color:#0c6">R</span><span style="color:#0c6">&#39;&lt;td style=&#34;WORD-WRAP: break-word&#34; bgcolor=&#34;#fdfddf&#34;&gt;&lt;a href=&#34;(?P&lt;load&gt;.*?)&#34;&#39;</span>, re<span style="color:#2c5dcd">.</span>S)
        a <span style="color:#2c5dcd">=</span>child_rename<span style="color:#2c5dcd">.</span>finditer(child_data)
        <span style="color:#2c5dcd;font-weight:bold">for</span> i <span style="color:#2c5dcd;font-weight:bold">in</span> a:
            <span style="color:#5918bb;font-weight:bold">print</span>(i<span style="color:#2c5dcd">.</span>group(<span style="color:#0c6">&#34;mname&#34;</span>))
            <span style="color:#5918bb;font-weight:bold">print</span>(i<span style="color:#2c5dcd">.</span>group(<span style="color:#0c6">&#34;load&#34;</span>))

<span style="color:#5918bb;font-weight:bold">print</span>(<span style="color:#0c6">&#34;爬取结束&#34;</span>)
</code></pre></td></tr></table>
</div>
</div><h2 id="代理">代理<a hidden class="anchor" aria-hidden="true" href="#代理">#</a></h2>
<p>代理：通过第三方的一个机器去发送请求（去网上找免费代理，或者找）</p>
<h2 id="综合训练-网易云音乐评论抓取">综合训练-网易云音乐评论抓取<a hidden class="anchor" aria-hidden="true" href="#综合训练-网易云音乐评论抓取">#</a></h2>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#0080ff;font-style:italic"># coding:utf-8</span>
<span style="color:#0080ff;font-style:italic"># @Time : 2022/5/16 10:07</span>
<span style="color:#0080ff;font-style:italic"># @file : 网易云音乐.py</span>
<span style="color:#0080ff;font-style:italic"># $software : PyCharm</span>
<span style="color:#0080ff;font-style:italic">#爬取网易云音乐评论</span>
<span style="color:#0080ff;font-style:italic"># 步骤：</span>
<span style="color:#0080ff;font-style:italic"># 1.找到未加密的数据</span>
<span style="color:#0080ff;font-style:italic"># 2.想办法把参数按照网易云音乐本身的逻辑加密</span>
<span style="color:#0080ff;font-style:italic"># 3.请求到网易，拿到评论信息</span>
<span style="color:#0080ff;font-style:italic"># 加密参数</span>
<span style="color:#0080ff;font-style:italic"># params:就是encText</span>
<span style="color:#0080ff;font-style:italic"># encSecKey:就是encSecKey</span>
<span style="color:#2c5dcd;font-weight:bold">from</span> Crypto.Cipher <span style="color:#2c5dcd;font-weight:bold">import</span> AES
<span style="color:#2c5dcd;font-weight:bold">import</span> requests
<span style="color:#2c5dcd;font-weight:bold">import</span> re
<span style="color:#2c5dcd;font-weight:bold">import</span> json
<span style="color:#2c5dcd;font-weight:bold">from</span> base64 <span style="color:#2c5dcd;font-weight:bold">import</span> b64encode

url <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#34;https://music.163.com/weapi/comment/resource/comments/get?csrf_token=&#34;</span>

<span style="color:#0080ff;font-style:italic">#POST请求</span>
headers <span style="color:#2c5dcd">=</span> {
<span style="color:#0c6">&#34;User-Agent&#34;</span>: <span style="color:#0c6">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#34;</span>
              <span style="color:#0c6">&#34; (KHTML, like Gecko) Chrome/97.0.4692.99 Safari/537.36&#34;</span>
}
<span style="color:#0080ff;font-style:italic">#找到了真正的参数，接下来还需要解密过程</span>
data <span style="color:#2c5dcd">=</span> {
<span style="color:#0c6">&#39;csrf_token&#39;</span>: <span style="color:#0c6">&#34;&#34;</span>,
<span style="color:#0c6">&#39;cursor&#39;</span>: <span style="color:#0c6">&#34;-1&#34;</span>,
<span style="color:#0c6">&#39;offset&#39;</span>: <span style="color:#0c6">&#34;0&#34;</span>,
<span style="color:#0c6">&#39;orderType&#39;</span>: <span style="color:#0c6">&#34;1&#34;</span>,
<span style="color:#0c6">&#39;pageNo&#39;</span>: <span style="color:#0c6">&#34;1&#34;</span>,
<span style="color:#0c6">&#39;pageSize&#39;</span>: <span style="color:#0c6">&#34;20&#34;</span>,
<span style="color:#0c6">&#39;rid&#39;</span>: <span style="color:#0c6">&#34;R_SO_4_441491828&#34;</span>,
<span style="color:#0c6">&#39;threadId&#39;</span>: <span style="color:#0c6">&#34;R_SO_4_441491828&#34;</span>
}

<span style="color:#0080ff;font-style:italic">#处理加密过程</span>

<span style="color:#0080ff;font-style:italic">#服务于windows.arXXX的加密过程</span>
e <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#39;010001&#39;</span>
f <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#39;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7&#39;</span>
g <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#39;0CoJUm6Qyw8W8jud&#39;</span>
i <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#39;LvjKmGgecBJv6kkF&#39;</span>      <span style="color:#0080ff;font-style:italic">#手动固定</span>
<span style="color:#0080ff;font-style:italic">#如果把i固定那么下面这个函数一定是固定的，由下面的c函数解出</span>
<span style="color:#2c5dcd;font-weight:bold">def</span> <span style="color:#ff8000;font-weight:bold">get_encSecKey</span>():
    <span style="color:#2c5dcd;font-weight:bold">return</span> <span style="color:#0c6">&#34;7c435414bc686e49dc26a57ffedbb80b320fd755755c5da8e72f416a61370039aa2d3fa333e54a6e7c9abe7f26faffa69d1721db76cb2e6f17d0393d4cfbc6176590909d027022c4e458aee2123c329b60e1e422beef0f8e39efad5014cbeab022199bc7e6c47a5d0bca5528f6c7946305ae019674309d562c69b39dde9ea429&#34;</span>

<span style="color:#0080ff;font-style:italic">#字典不能加密，所以下面这个函数默认收到的是字符串</span>
<span style="color:#2c5dcd;font-weight:bold">def</span> <span style="color:#ff8000;font-weight:bold">get_params</span>(data):
    <span style="color:#0c6">&#34;&#34;&#34;
</span><span style="color:#0c6">    就是去还原下面的b的两次加密
</span><span style="color:#0c6">    h.encText = b(d, g),   d是数据 g是密钥 g:固定值 &#39;0CoJUm6Qyw8W8jud&#39;
</span><span style="color:#0c6">    h.encText = b(h.encText, i)
</span><span style="color:#0c6">    :param data:
</span><span style="color:#0c6">    :return:
</span><span style="color:#0c6">    &#34;&#34;&#34;</span>
    first <span style="color:#2c5dcd">=</span> enc_params(data, g)
    second <span style="color:#2c5dcd">=</span> enc_params(first, i)
    <span style="color:#2c5dcd;font-weight:bold">return</span> second       <span style="color:#0080ff;font-style:italic">#返回的就是params</span>

<span style="color:#0080ff;font-style:italic">#转换成16的长度为加密算法服务</span>
<span style="color:#2c5dcd;font-weight:bold">def</span> <span style="color:#ff8000;font-weight:bold">to_16</span>(data):
    pad <span style="color:#2c5dcd">=</span> <span style="color:#5918bb;font-weight:bold">16</span> <span style="color:#2c5dcd">-</span> <span style="color:#5918bb;font-weight:bold">len</span>(data) <span style="color:#2c5dcd">%</span> <span style="color:#5918bb;font-weight:bold">16</span>
    data <span style="color:#2c5dcd">+=</span> <span style="color:#5918bb;font-weight:bold">chr</span>(pad) <span style="color:#2c5dcd">*</span>pad
    <span style="color:#2c5dcd;font-weight:bold">return</span> data


<span style="color:#0080ff;font-style:italic">#第二个参数的加密算法</span>
<span style="color:#2c5dcd;font-weight:bold">def</span> <span style="color:#ff8000;font-weight:bold">enc_params</span>(data, key):
    iv <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#39;0102030405060708&#39;</span>
    data <span style="color:#2c5dcd">=</span> to_16(data)
    aes <span style="color:#2c5dcd">=</span> AES<span style="color:#2c5dcd">.</span>new(key<span style="color:#2c5dcd">=</span>key<span style="color:#2c5dcd">.</span>encode(<span style="color:#0c6">&#34;utf-8&#34;</span>), IV<span style="color:#2c5dcd">=</span>iv, mode<span style="color:#2c5dcd">=</span>AES<span style="color:#2c5dcd">.</span>MODE_CBC) <span style="color:#0080ff;font-style:italic">#创建了一个加密工具</span>
    bs <span style="color:#2c5dcd">=</span> aes<span style="color:#2c5dcd">.</span>encrypt(data<span style="color:#2c5dcd">.</span>encode(<span style="color:#0c6">&#34;utf-8&#34;</span>))
    <span style="color:#0080ff;font-style:italic">#如果想要返回字符串还需要base64转码</span>
    <span style="color:#2c5dcd;font-weight:bold">return</span> <span style="color:#5918bb;font-weight:bold">str</span>(b64encode(bs), <span style="color:#0c6">&#34;utf-8&#34;</span>)
    <span style="color:#2c5dcd;font-weight:bold">pass</span>

<span style="color:#0c6">&#34;&#34;&#34;
</span><span style="color:#0c6">    function a(a) {
</span><span style="color:#0c6">        var d, e, b = &#34;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#34;, c = &#34;&#34;;
</span><span style="color:#0c6">        for (d = 0; a &gt; d; d += 1)  #循环16次
</span><span style="color:#0c6">            e = Math.random() * b.length,   #产生随机数
</span><span style="color:#0c6">            e = Math.floor(e),  #取整
</span><span style="color:#0c6">            c += b.charAt(e);
</span><span style="color:#0c6">        return c  #返回一个16个字母
</span><span style="color:#0c6">    }
</span><span style="color:#0c6">    function b(a, b) {  a是要加密的内容
</span><span style="color:#0c6">        var c = CryptoJS.enc.Utf8.parse(b)   c和b是一回事
</span><span style="color:#0c6">          , d = CryptoJS.enc.Utf8.parse(&#34;0102030405060708&#34;)  偏移量
</span><span style="color:#0c6">          , e = CryptoJS.enc.Utf8.parse(a)   e和a相同都是数据
</span><span style="color:#0c6">          , f = CryptoJS.AES.encrypt(e, c, { e是数据，c是  AES是加密算法自己查的话可以知道下面的东西
</span><span style="color:#0c6">            iv: d,   偏移量
</span><span style="color:#0c6">            mode: CryptoJS.mode.CBC  加密模式CBC    看完之后发现少了个密钥所以c(b)是密钥
</span><span style="color:#0c6">        });
</span><span style="color:#0c6">        return f.toString()
</span><span style="color:#0c6">    }
</span><span style="color:#0c6">    function c(a, b, c) {
</span><span style="color:#0c6">        var d, e;
</span><span style="color:#0c6">        return setMaxDigits(131),
</span><span style="color:#0c6">        d = new RSAKeyPair(b,&#34;&#34;,c),     #RSA加密
</span><span style="color:#0c6">        e = encryptedString(d, a)
</span><span style="color:#0c6">    }
</span><span style="color:#0c6">    function d(d, e, f, g) {                                    d：就是真实数据data,除了数据d是变的之外，其他都是不变的
</span><span style="color:#0c6">        var h = </span><span style="color:#0c6">{}</span><span style="color:#0c6">        产生一个空对象                           e：固定值 &#39;010001&#39;
</span><span style="color:#0c6">          , i = a(16);    i是一个16位数的随机字符串                          f:超长定值 &#39;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7&#39;
</span><span style="color:#0c6">         h.encText = b(d, g),   d是数据 g是密钥                                 g:固定值 &#39;0CoJUm6Qyw8W8jud&#39;
</span><span style="color:#0c6">        h.encText = b(h.encText, i), i是密钥   #返回的就是加密数据param
</span><span style="color:#0c6">        
</span><span style="color:#0c6">                                     #如果i固定那么encSeckey就固定
</span><span style="color:#0c6">        h.encSecKey = c(i, e, f),     i是一个16位数的随机字符串，ef是固定的值  #返回的就是加密参数encSecKey
</span><span style="color:#0c6">        
</span><span style="color:#0c6">        return h
</span><span style="color:#0c6">    }windows.a   = d加密参数的入口是d
</span><span style="color:#0c6">    
</span><span style="color:#0c6">    
</span><span style="color:#0c6">    encText是通过两次加密得出第二个加密参数
</span><span style="color:#0c6">&#34;&#34;&#34;</span>


response <span style="color:#2c5dcd">=</span> requests<span style="color:#2c5dcd">.</span>post(url, headers<span style="color:#2c5dcd">=</span>headers, data<span style="color:#2c5dcd">=</span>{
<span style="color:#0c6">&#34;params&#34;</span>:get_params(json<span style="color:#2c5dcd">.</span>dumps(data)),
<span style="color:#0c6">&#34;encSecKey&#34;</span>:get_encSecKey()
})
<span style="color:#5918bb;font-weight:bold">print</span>(response<span style="color:#2c5dcd">.</span>text)

<span style="color:#0080ff;font-style:italic"># list = response.json()[&#39;data&#39;][&#39;hotComments&#39;]</span>
<span style="color:#0080ff;font-style:italic"># res = re.compile(r&#34;&#39;content&#39;: &#39;(.*?)&#39;,&#34;)</span>
<span style="color:#0080ff;font-style:italic"># # print(list[0])</span>
<span style="color:#0080ff;font-style:italic"># print(res.findall(str(list)))</span>
response<span style="color:#2c5dcd">.</span>close()
<span style="color:#5918bb;font-weight:bold">print</span>(<span style="color:#0c6">&#34;OVER!&#34;</span>)
</code></pre></td></tr></table>
</div>
</div><h3 id="后续练习">[后续练习]<a hidden class="anchor" aria-hidden="true" href="#后续练习">#</a></h3>
<p>熟练使用浏览器开发者工具</p>
<hr>
<h3 id="附录">[附录]<a hidden class="anchor" aria-hidden="true" href="#附录">#</a></h3>
<p>使用<code>.*?</code>代替变化的内容，使用<code>(.*?)</code>代表需要提取的内容</p>
<p>记得关闭请求</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://hanson00.github.io/tags/%E7%88%AC%E8%99%AB/">爬虫</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://hanson00.github.io/posts/technology/golang/01gin/">
    <span class="title">« Prev</span>
    <br>
    <span>01gin</span>
  </a>
  <a class="next" href="https://hanson00.github.io/posts/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3/git%E5%AD%A6%E4%B9%A0/">
    <span class="title">Next »</span>
    <br>
    <span>Git学习</span>
  </a>
</nav>

  </footer>
<div>
    <div class="pagination__title">
        <span class="pagination__title-h" style="font-size: 20px;">💬评论</span>✨昵称输入QQ号可以自动关联✨
        <hr />

    </div>
    <div id="tcomment"></div>
    <script src="https://cdn.staticfile.org/twikoo/1.5.11/twikoo.all.min.js"></script>
    <script>
        twikoo.init({
            envId: "https://twikoo1-mu.vercel.app/",  
            el: "#tcomment",
            lang: 'zh-CN',
            region: 'ap-guangzhou',  
            path: window.TWIKOO_MAGIC_PATH || window.location.pathname,
        });
    </script>
</div>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://hanson00.github.io/">Hanson&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
