<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Astæ··æ·†æŠ€æœ¯ | Hanson&#39;s Blog</title>
<meta name="keywords" content="">
<meta name="description" content="astå­¦ä¹ ">
<meta name="author" content="
ä½œè€…:&nbsp;hanson">
<link rel="canonical" href="https://hanson00.github.io/posts/technology/js%E9%80%86%E5%90%91/ast%E6%B7%B7%E6%B7%86%E6%8A%80%E6%9C%AF/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.845a44c8f19c77e054f472b3a0bacb3d33effea14f20590af5e97de848f8ab8b.css" integrity="sha256-hFpEyPGcd&#43;BU9HKzoLrLPTPv/qFPIFkK9el96Ej4q4s=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://hanson00.github.io/posts/imgs/66.jpg">
<link rel="icon" type="image/png" sizes="16x16" href="https://hanson00.github.io/posts/imgs/favicon16x16.ico">
<link rel="icon" type="image/png" sizes="32x32" href="https://hanson00.github.io/posts/imgs/favicon32x32.ico">
<link rel="apple-touch-icon" href="https://hanson00.github.io/posts/imgs/66.jpg">
<link rel="mask-icon" href="https://hanson00.github.io/posts/imgs/66.jpg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Astæ··æ·†æŠ€æœ¯" />
<meta property="og:description" content="astå­¦ä¹ " />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hanson00.github.io/posts/technology/js%E9%80%86%E5%90%91/ast%E6%B7%B7%E6%B7%86%E6%8A%80%E6%9C%AF/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-17T16:21:43&#43;08:00" />
<meta property="article:modified_time" content="2023-03-17T16:21:43&#43;08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Astæ··æ·†æŠ€æœ¯"/>
<meta name="twitter:description" content="astå­¦ä¹ "/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://hanson00.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "ğŸ’»æŠ€æœ¯ç±»æ–‡ç« ",
      "item": "https://hanson00.github.io/posts/technology/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "Astæ··æ·†æŠ€æœ¯",
      "item": "https://hanson00.github.io/posts/technology/js%E9%80%86%E5%90%91/ast%E6%B7%B7%E6%B7%86%E6%8A%80%E6%9C%AF/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Astæ··æ·†æŠ€æœ¯",
  "name": "Astæ··æ·†æŠ€æœ¯",
  "description": "astå­¦ä¹ ",
  "keywords": [
    ""
  ],
  "articleBody": "astæŠ€æœ¯ astæŠ€æœ¯å¯¹çˆ¬è™«å·¥ç¨‹å¸ˆæ¥è¯´åªæ˜¯ä¸€ç§è¾…åŠ©å·¥å…·ï¼Œå¹¶ä¸èƒ½å¸®æˆ‘ä»¬æ‰¾åˆ°æ ¸å¿ƒçš„ä»£ç ï¼Œä½†èƒ½å¤Ÿæé«˜æˆ‘ä»¬æ‰£æ··æ·†jsçš„æ•ˆç‡ï¼Œæé«˜ä»£ç å¯è¯»æ€§ã€‚\nåœ¨ç¼–è¯‘åŸç†ä¸­ï¼Œç¼–è¯‘å™¨è½¬æ¢ä»£ç é€šå¸¸è¦ç»è¿‡ä¸‰ä¸ªæ­¥éª¤ï¼šè¯æ³•åˆ†æï¼ˆLexical Analysisï¼‰ã€è¯­æ³•åˆ†æï¼ˆSyntax Analysisï¼‰ã€ä»£ç ç”Ÿæˆï¼ˆCode Generationï¼‰\nå­¦ä¹ astä¸»è¦å°±æ˜¯åˆ¤æ–­èŠ‚ç‚¹ï¼Œå†™æ¡ä»¶ï¼Œè¿˜åŸä»£ç \nastçš„å®šä¹‰ ast(Absctact Syntax Tree)ï¼Œè¯‘ä¸ºæŠ½è±¡è¯­æ³•æ ‘ã€‚ä¸ºæºä»£ç çš„æŠ½è±¡è¯­æ³•ç»“æ„çš„æ ‘çŠ¶è¡¨ç¤ºï¼Œæ ‘ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¡¨ç¤ºæºä»£ç ä¸­çš„ä¸€ç§ç»“æ„ï¼Œè¿™ç§æ•°æ®ç»“æ„å¯ä»¥ç±»åˆ«ä¸ºä¸€ä¸ªå¤§çš„JSONå¯¹è±¡ã€‚é€šè¿‡ AST æŠ€æœ¯ï¼Œæˆ‘ä»¬é¢å¯¹çš„å°±ä¸å†æ˜¯å„ç§ç¬¦å·æ··æ‚ç©ºæ ¼è€Œæˆçš„æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ä¸€ä¸ªä¸¥è°¨è§„èŒƒçš„æ ‘å½¢ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹ AST æ ‘èŠ‚ç‚¹çš„ä¸€ç³»åˆ—æ“ä½œï¼Œå€ŸåŠ©æœºå™¨é«˜æ•ˆä¸”ç²¾å‡†åœ°ä¿®æ”¹ä»£ç ã€‚\n1 2 3  ä¸‹é¢ä¸¤æ®µjsä»£ç ç­‰ä»·ï¼Œç›¸å½“äºä»'sm-crypto'ä¸­è¯»å–sm2æ¨¡å— const sm2 = require('sm-crypto').sm2 const {sm2} = require('sm-crypto')   AST çš„ç”¨é€” IDE çš„è¯­æ³•é«˜äº®ã€ä»£ç æ£€æŸ¥ã€æ ¼å¼åŒ–ã€å‹ç¼©ã€è½¬è¯‘ç­‰ã€‚å°† ES6è½¬åŒ–æˆES5å®ç°è¯­æ³•å…¼å®¹\nASTæ’ä»¶çš„èµ„æº   Astexplorer.netï¼šä¸€ä¸ªåœ¨çº¿çš„ASTæµè§ˆå™¨å’Œç¼–è¾‘å™¨ï¼Œå¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿåˆ›å»ºå’Œè°ƒè¯•ASTæ’ä»¶ã€‚\n  Esprimaå’ŒBabelï¼šè¿™ä¸¤ä¸ªå·¥å…·æ˜¯ç”¨äºJavaScriptçš„è§£æå™¨å’Œè½¬è¯‘å™¨ï¼Œå¯ä»¥å¸®åŠ©ä½ æ„å»ºJavaScript ASTæ’ä»¶ã€‚\n  Pythonçš„astæ¨¡å—ï¼šPythonå†…ç½®çš„astæ¨¡å—æä¾›äº†ä¸€ç»„å·¥å…·æ¥å¤„ç†Pythonä»£ç çš„ASTï¼Œå¯ä»¥å¸®åŠ©ä½ æ„å»ºPython ASTæ’ä»¶ã€‚\n  LLVMï¼šä¸€ä¸ªå¼€æºçš„ç¼–è¯‘å™¨åŸºç¡€è®¾æ–½ï¼Œæä¾›äº†è®¸å¤šåº“å’Œå·¥å…·æ¥å¤„ç†ASTå’ŒIRï¼Œå¯ä»¥å¸®åŠ©ä½ æ„å»ºC++ç­‰è¯­è¨€çš„ASTæ’ä»¶ã€‚\n  å­¦ä¹ astå‚è€ƒåœ°å€ï¼šhttps://evilrecluse.top/Babel-traverse-api-doc/#/\n  è§£æ··æ·†APIå­¦ä¹  1  var a = \"\\u0068\\u0065\\u006c\\u006c\\u006f\\u002c\\u0041\\u0053\\u0054\"   1. type: è¡¨ç¤ºå½“å‰èŠ‚ç‚¹çš„ç±»å‹ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„ç±»å‹åˆ¤æ–­æ–¹æ³• t.is ****(node),å°±æ˜¯åˆ¤æ–­å½“å‰çš„èŠ‚ç‚¹æ˜¯å¦ä¸ºæŸä¸ªç±»å‹ã€‚\n2. start: è¡¨ç¤ºå½“å‰èŠ‚ç‚¹çš„èµ·å§‹ä½ã€‚\n3. end: è¡¨ç¤ºå½“å‰èŠ‚ç‚¹çš„æœ«å°¾ã€‚\n4. loc : è¡¨ç¤ºå½“å‰èŠ‚ç‚¹æ‰€åœ¨çš„è¡Œåˆ—ä½ç½®ï¼Œé‡Œé¢ä¹Ÿæœ‰startä¸endèŠ‚ç‚¹ï¼Œè¿™é‡Œçš„startä¸ä¸Šé¢çš„startæ˜¯ä¸åŒçš„ï¼Œè¿™é‡Œçš„startæ˜¯è¡¨ç¤ºèŠ‚ç‚¹æ‰€åœ¨èµ·å§‹çš„è¡Œåˆ—ä½ã€‚ç½®ï¼Œè€Œendè¡¨ç¤ºçš„æ˜¯èŠ‚ç‚¹æ‰€åœ¨æœ«å°¾çš„è¡Œåˆ—ä½ç½®ã€‚\n5. errors:æ˜¯FileèŠ‚ç‚¹æ‰€ç‰¹æœ‰çš„å±æ€§ï¼Œå¯ä»¥ä¸ç”¨ç†ä¼šã€‚\n6. program:åŒ…å«æ•´ä¸ªæºä»£ç ï¼Œä¸åŒ…å«æ³¨é‡ŠèŠ‚ç‚¹ã€‚\n7. comments:æºä»£ç ä¸­æ‰€æœ‰çš„æ³¨é‡Šä¼šåœ¨è¿™é‡Œæ˜¾ç¤ºã€‚\nå„ç§å¸¸è§çš„èŠ‚ç‚¹ç±»å‹ fsåº“å¯ä»¥è§£å†³jsçš„æ–‡ä»¶è¯»å†™é—®é¢˜ è¯»å–æ–‡ä»¶\n1  xx = _fs.readFileSync('test.js',{encoding:'utf-8'})   å†™å…¥æ–‡ä»¶\n1  fs.writeFile('decode.js', code, (err)={});   å®‰è£…babelåº“  @babel/coreï¼šBabel ç¼–è¯‘å™¨æœ¬èº«ï¼Œæä¾›äº† babel çš„ç¼–è¯‘ APIï¼› @babel/parserï¼šå°† JavaScript ä»£ç è§£ææˆ AST è¯­æ³•æ ‘ï¼› @babel/traverseï¼šéå†ã€ä¿®æ”¹ AST è¯­æ³•æ ‘çš„å„ä¸ªèŠ‚ç‚¹ï¼› @babel/generatorï¼šå°† AST è¿˜åŸæˆ JavaScript ä»£ç ï¼› @babel/typesï¼šåˆ¤æ–­ã€éªŒè¯èŠ‚ç‚¹çš„ç±»å‹ã€æ„å»ºæ–° AST èŠ‚ç‚¹ç­‰ã€‚  1  npm install @babel/core --save-dev   å°è¯•ç‰›åˆ€ parserçš„ä½¿ç”¨ 1 2 3 4 5 6  const parse = require('@babel/parser') js_code = `var a = \"\\u0068\\u0065\\u006c\\u006c\\u006f\\u002c\\u0041\\u0053\\u0054\"` let astTree = parse.parse(js_code) console.log(JSON.stringify(astTree, null, '\\t'))   è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š\nå’Œastè§£æ··æ·†ç½‘ç«™è¾“å‡ºçš„ç»“æœç›¸åŒ\ntraverseçš„ä½¿ç”¨ traverseè´Ÿè´£ç¼–å†™æ’ä»¶è¿˜åŸJavaScript\npathçš„å±æ€§ path.node:è¡¨ç¤ºå½“å‰pathä¸‹çš„nodeèŠ‚ç‚¹\npath.toString():å½“å‰è·¯å¾„æ‰€å¯¹åº”çš„æºä»£ç \npath.parentPath:ç”¨äºè·å–å½“å‰pathä¸‹çš„çˆ¶pathï¼Œå¤šç”¨äºåˆ¤æ–­èŠ‚ç‚¹ç±»å‹\npath.container:ç”¨äºè·å–å½“å‰pathä¸‹çš„æ‰€æœ‰å…„å¼ŸèŠ‚ç‚¹(åŒ…æ‹¬è‡ªèº«)\npath.type:è·å–å½“å‰èŠ‚ç‚¹ç±»å‹\npath.get(''):è·å–pathçš„å­è·¯å¾„\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52  const parse = require('@babel/parser') //è´Ÿè´£ç¼–å†™è§£æ··æ·†æ’ä»¶ const traverse = require('@babel/traverse').default const generator = require('@babel/generator').default js_code = `var a = \"\\u0068\\u0065\\u006c\\u006c\\u006f\\u002c\\u0041\\u0053\\u0054\"` let astTree = parse.parse(js_code) // ç¼–å†™æ’ä»¶ï¼Œè¿˜åŸJavaScript // traverse(astTree, { // VariableDeclaration(path){ // // path.node è¡¨ç¤ºå½“å‰èŠ‚ç‚¹ // console.log(path.node) // // // path.type è·å–å½“å‰èŠ‚ç‚¹çš„ç±»å‹ // // console.log(path.type) // // //path.toString() è·å–æºä»£ç  // console.log(path.toString()) // // //ä¸‹é¢ä¸¤ä¸ªè¯­å¥ä½œç”¨ç›¸åŒ // console.log(path.parent) // // console.log(path.parentPath.node) // // console.log('-------------------------------') // // .get()æ‰¾ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ // // console.log(path.get('declarations') // } // })  //å¤„ç†ç¼–ç  plug = { StringLiteral(path){ path.node.extra.raw = path.node.extra.rawValue } } traverse(astTree, plug) // traverse(astTree, { // Identifier(path){ // console.log(path.node.name) // } // }) // // traverse(astTree, { // StringLiteral(path){ // console.log(path.node.value) // // } // })  let {code} = generator(astTree) console.log(code)   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  const parse = require('@babel/parser') const traverse = require('@babel/traverse').default const generator = require('@babel/generator').default js_code = `var a = \"\\u0068\\u0065\\u006c\\u006c\\u006f\\u002c\\u0041\\u0053\\u0054\"` let astTree = parse.parse(js_code) let code1 = generator(astTree) console.log(code1) // `@babel/generator`ï¼šå°† AST è¿˜åŸæˆ JavaScript ä»£ç  // {code}æ˜¯ä»è¿˜åŸçš„ä»£ç ä¸­è·å–JavaScriptæºä»£ç ï¼Œè¿è¡Œä»£ç å¯ä»¥è‡ªå·±çœ‹çœ‹ let {code} = generator(astTree) console.log('-------------------') console.log(code)   pathæ–¹æ³• path.replaceWith:(å•)èŠ‚ç‚¹æ›¿æ¢å‡½æ•°\nreplaceWithMultiple å¤šèŠ‚ç‚¹æ›¿æ¢å‡½æ•°ï¼Œè°ƒç”¨æ–¹å¼:\n1  path.replaceWithMultiple(ArrayNode);   replaceWithMultiple æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ªèŠ‚ç‚¹æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªæ•°ç»„ä¸­çš„èŠ‚ç‚¹ä¼šè¢«æ›¿æ¢å½“å‰çš„èŠ‚ç‚¹ã€‚è¿™äº›æ–°èŠ‚ç‚¹å¯ä»¥æ˜¯ä»»ä½•åˆæ³•çš„ AST èŠ‚ç‚¹ï¼Œä¾‹å¦‚è¡¨è¾¾å¼ã€è¯­å¥ã€å£°æ˜ç­‰\n1  path.replaceWith(newNode);   1 2 3  !(function () { console.log('66666') })   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  // è¿˜åŸå‡½æ•° traverse(astTree, { UnaryExpression(path) { let {argument} = path.node if (!types.isFunctionExpression(argument)) { return } let {body, id, params} = argument if (id != null || params.length != 0) { return } //`replaceWithMultiple `å¤šèŠ‚ç‚¹æ›¿æ¢å‡½æ•°ï¼Œè°ƒç”¨æ–¹å¼:  path.replaceWithMultiple(body.body); } })   evaluate()æ–¹æ³•å­¦ä¹ \né’ˆå¯¹ä½œç”¨åŸŸå’Œå¼•ç”¨ï¼Œç›´æ¥ä¾æ®å¼•ç”¨æ¥è®¡ç®—å‡ºæ‰§è¡Œç»“æœã€‚\nä¾‹å­ï¼šnavigator[\"\\x75\\x73\"+\"\\x65\\x72\"+\"\\x41\\x67\"+\"\\x65\\x6e\"+\"\\x74\"]\nä¾‹å­2ï¼š\n1 2 3  function _xl(){ x = 1 + 2 + 3 +4 + 5 + 6 + 7 }   æ’ä»¶ç¼–å†™\n1 2 3 4 5 6 7  visitor2 = { \"BinaryExpression|Identifier\"(path){ const {confident,value} = path.evaluate(); confident \u0026\u0026 path.replaceInline(types.valueToNode(value)) } } traverse(_ast,visitor2)   ç¼–ç ç±»å‹è¿˜åŸ\nå¤„ç†å‰:\n1 2 3  var a = 0x25,b = 0b10001001,c = 0o123456, d = \"\\x68\\x65\\x6c\\x6c\\x6f\\x2c\\x41\\x53\\x54\", e = \"\\u0068\\u0065\\u006c\\u006c\\u006f\\u002c\\u0041\\u0053\\u0054\";   å¤„ç†å:\n1  var a = 37,b = 137,c = 42798,d = \"hello,AST\",e = \"hello,AST\";   æ’ä»¶ç¼–å†™:\n1 2 3 4 5 6 7 8 9 10 11 12 13  const transform_literal = { NumericLiteral({node}) { if (node.extra \u0026\u0026 /^0[obx]/i.test(node.extra.raw)) { node.extra = undefined; } }, StringLiteral({node}) { if (node.extra \u0026\u0026 /\\\\[ux]/gi.test(node.extra.raw)) { node.extra = undefined; } }, }    é€šç”¨æ’ä»¶\n 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  const constantFold = { \"BinaryExpression|UnaryExpression|ConditionalExpression\"(path) { // é˜²æ­¢æº¢å‡º  if(path.isUnaryExpression({operator:\"-\"}) || path.isUnaryExpression({operator:\"void\"})) { return; } const {confident, value} = path.evaluate(); if (!confident) return; if (typeof value == 'number' \u0026\u0026 (!Number.isFinite(value))) { return; } path.replaceWith(types.valueToNode(value)); }, } traverse(_ast, constantFold);   fså¯¼å‡ºä¸è¯»å–æ–‡ä»¶ è¯»å–æ–‡ä»¶\n1  gy = _fs.readFileSync('test.js',{encoding:'utf-8'})   å†™å…¥æ–‡ä»¶\n1  fs.writeFile('decode.js', code, (err)={});   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145  const parse = require('@babel/parser') const traverse = require('@babel/traverse').default const generator = require('@babel/generator').default const fs = require('fs') const types = require('@babel/types') js_code = fs.readFileSync('encode.js', {encoding: 'utf-8'}) let astTree = parse.parse(js_code) // å¤„ç†ç¼–ç  // å˜é‡èµ‹å€¼è¿˜åŸ traverse(astTree, { // å˜é‡èµ‹å€¼è¿˜åŸ  StringLiteral(path) { path.node.extra.raw = path.node.rawValue } }) // + æ‹¼æ¥è¿˜åŸ traverse(astTree, { // + æ‹¼æ¥è¿˜åŸ  BinaryExpression(path) { let {left, operator, right} = path.node; // console.log(left)  // console.log(left.value)  if (types.isNumericLiteral(left) \u0026\u0026 types.isNumericLiteral(right) \u0026\u0026 operator == \"+\") { value = left.value + right.value path.replaceWith(types.valueToNode(value)) // è¿›è¡Œæ–¹æ³•æ›¿æ¢  } if (types.isStringLiteral(left) \u0026\u0026 types.isStringLiteral(right) \u0026\u0026 operator == '+') { let value = left.value + right.value path.replaceWith(types.valueToNode(value)) } } }) // è¿˜åŸå‡½æ•° traverse(astTree, { UnaryExpression(path) { let {argument} = path.node if (!types.isFunctionExpression(argument)) { return } let {body, id, params} = argument if (id != null || params.length != 0) { return } //`replaceWithMultiple `å¤šèŠ‚ç‚¹æ›¿æ¢å‡½æ•°ï¼Œè°ƒç”¨æ–¹å¼:  path.replaceWithMultiple(body.body); } }) // è¿˜åŸå¸¦æ‹¬å·çš„è‡ªæ‰§è¡Œæ–¹æ³• traverse(astTree, { UnaryExpression(path) { let {argument} = path.node // console.log(argument)  if (!types.isCallExpression(argument)) { return } // console.log(argument.callee)  let {body, id, params} = argument.callee if (id != null || params.length != 0) { return } //`replaceWithMultiple `å¤šèŠ‚ç‚¹æ›¿æ¢å‡½æ•°ï¼Œè°ƒç”¨æ–¹å¼:  path.replaceWithMultiple(body.body); } }) // è¿˜åŸvar arr = '3,4,0,5,1,2'['split'](',')ä»£ç æœ‰é—®é¢˜ // traverse(astTree, { // CallExpression(path){ // let {callee,arguments} = path.node // // objectæ˜¯åˆ—è¡¨çš„å€¼ // let object = callee.object.value; // // console.log(object) // // //propertyæ˜¯æ–¹æ³•split // let property = callee.property.value; // // console.log(property) // // é€—å· // let argument = arguments[0].value; // // console.log(argument) // // //æ¨¡æ‹Ÿæ‰§è¡Œæ–¹æ³• // array = property[object](argument) // path.replaceWithMultiple(types.valueToNode(array)) // } // })  // è®¡ç®—ç»“æœæ‹¼æ¥ é’ˆå¯¹ä½œç”¨åŸŸå’Œå¼•ç”¨ï¼Œç›´æ¥ä¾æ®å¼•ç”¨æ¥è®¡ç®—å‡ºæ‰§è¡Œç»“æœã€‚ traverse(astTree, { \"BinaryExpression|Identifier\"(path){ const {confident,value} = path.evaluate(); confident \u0026\u0026 path.replaceInline(types.valueToNode(value)) } }) //é€šç”¨æ’ä»¶ const constantFold = { \"BinaryExpression|UnaryExpression|ConditionalExpression\"(path) { // é˜²æ­¢æº¢å‡º  if(path.isUnaryExpression({operator:\"-\"}) || path.isUnaryExpression({operator:\"void\"})) { return; } const {confident, value} = path.evaluate(); if (!confident) return; if (typeof value == 'number' \u0026\u0026 (!Number.isFinite(value))) { return; } path.replaceWith(types.valueToNode(value)); }, } traverse(astTree, constantFold); // ç¼–ç ç±»å‹è¿˜åŸï¼Œå¤„ç†ç¼–ç å’Œè¿›åˆ¶æ’ä»¶ const transform_literal = { NumericLiteral({node}) { if (node.extra \u0026\u0026 /^0[obx]/i.test(node.extra.raw)) { node.extra = undefined; } }, StringLiteral({node}) { if (node.extra \u0026\u0026 /\\\\[ux]/gi.test(node.extra.raw)) { node.extra = undefined; } }, } traverse(astTree, transform_literal); let {code} = generator(astTree) console.log('--------------------------') console.log(code) fs.writeFile('decode.js', code, (err) = { });   ",
  "wordCount" : "3100",
  "inLanguage": "en",
  "datePublished": "2023-03-17T16:21:43+08:00",
  "dateModified": "2023-03-17T16:21:43+08:00",
  "author":[{
    "@type": "Person",
    "name": "hanson"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://hanson00.github.io/posts/technology/js%E9%80%86%E5%90%91/ast%E6%B7%B7%E6%B7%86%E6%8A%80%E6%9C%AF/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Hanson's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://hanson00.github.io/posts/imgs/66.jpg"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://hanson00.github.io/" accesskey="h" title="Hanson&#39;s Blog (Alt + H)">Hanson&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://hanson00.github.io/search" title="ğŸ”æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ”æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://hanson00.github.io/" title="ğŸ ä¸»é¡µ">
                    <span>ğŸ ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://hanson00.github.io/posts" title="ğŸ“šæ–‡ç« ">
                    <span>ğŸ“šæ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://hanson00.github.io/archives/" title="â±æ—¶é—´è½´">
                    <span>â±æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://hanson00.github.io/tags" title="ğŸ”–æ ‡ç­¾">
                    <span>ğŸ”–æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://hanson00.github.io/about" title="ğŸ™‹ğŸ»â€â™‚ï¸å…³äº">
                    <span>ğŸ™‹ğŸ»â€â™‚ï¸å…³äº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">

  <header class="post-header">
    <div class="breadcrumbs"><a href="https://hanson00.github.io/">Home</a>&nbsp;Â»&nbsp;<a href="https://hanson00.github.io/posts/">Posts</a>&nbsp;Â»&nbsp;<a href="https://hanson00.github.io/posts/technology/">ğŸ’»æŠ€æœ¯ç±»æ–‡ç« </a></div>
    <h1 class="post-title">
      Astæ··æ·†æŠ€æœ¯
    </h1>
    <div class="post-description">
      astå­¦ä¹ 
    </div>
    <div class="post-meta">










æ›´æ–°:&nbsp;2023-03-17&nbsp;|&nbsp;å­—æ•°:&nbsp;3100å­—&nbsp;|&nbsp;æ—¶é•¿: 7åˆ†é’Ÿ&nbsp;|&nbsp;
ä½œè€…:&nbsp;hanson&nbsp;|&nbsp;æ ‡ç­¾: &nbsp;
      <ul class="post-tags-meta">
        <a href="https://hanson00.github.io/tags/js%E9%80%86%E5%90%91/">jsé€†å‘</a>
        <a href="https://hanson00.github.io/tags/%E7%88%AC%E8%99%AB/">ã€çˆ¬è™«</a>
      </ul>

      <span id="busuanzi_container_page_pv">
        &nbsp;| è®¿é—®: <span id="busuanzi_value_page_pv"></span>
      </span>

</div>
  </header> <aside id="toc-container" class="toc-container wide">
        <div class="toc">
            <details  open>
                <summary accesskey="c" title="(Alt + C)">
                    <span class="details">Table of Contents</span>
                </summary>

                <div class="inner"><ul>
                        <li>
                            <a href="#ast%e6%8a%80%e6%9c%af" aria-label="astæŠ€æœ¯">astæŠ€æœ¯</a><ul>
                                    
                        <li>
                            <a href="#ast%e7%9a%84%e5%ae%9a%e4%b9%89" aria-label="astçš„å®šä¹‰">astçš„å®šä¹‰</a></li>
                        <li>
                            <a href="#ast-%e7%9a%84%e7%94%a8%e9%80%94" aria-label="AST çš„ç”¨é€”">AST çš„ç”¨é€”</a></li>
                        <li>
                            <a href="#ast%e6%8f%92%e4%bb%b6%e7%9a%84%e8%b5%84%e6%ba%90" aria-label="ASTæ’ä»¶çš„èµ„æº">ASTæ’ä»¶çš„èµ„æº</a></li>
                        <li>
                            <a href="#%e8%a7%a3%e6%b7%b7%e6%b7%86api%e5%ad%a6%e4%b9%a0" aria-label="è§£æ··æ·†APIå­¦ä¹ ">è§£æ··æ·†APIå­¦ä¹ </a><ul>
                                    
                        <li>
                            <a href="#%e5%90%84%e7%a7%8d%e5%b8%b8%e8%a7%81%e7%9a%84%e8%8a%82%e7%82%b9%e7%b1%bb%e5%9e%8b" aria-label="å„ç§å¸¸è§çš„èŠ‚ç‚¹ç±»å‹">å„ç§å¸¸è§çš„èŠ‚ç‚¹ç±»å‹</a></li>
                        <li>
                            <a href="#fs%e5%ba%93%e5%8f%af%e4%bb%a5%e8%a7%a3%e5%86%b3js%e7%9a%84%e6%96%87%e4%bb%b6%e8%af%bb%e5%86%99%e9%97%ae%e9%a2%98" aria-label="fsåº“å¯ä»¥è§£å†³jsçš„æ–‡ä»¶è¯»å†™é—®é¢˜">fsåº“å¯ä»¥è§£å†³jsçš„æ–‡ä»¶è¯»å†™é—®é¢˜</a></li>
                        <li>
                            <a href="#%e5%ae%89%e8%a3%85babel%e5%ba%93" aria-label="å®‰è£…babelåº“">å®‰è£…babelåº“</a></li>
                        <li>
                            <a href="#%e5%b0%8f%e8%af%95%e7%89%9b%e5%88%80" aria-label="å°è¯•ç‰›åˆ€">å°è¯•ç‰›åˆ€</a><ul>
                                    
                        <li>
                            <a href="#parser%e7%9a%84%e4%bd%bf%e7%94%a8" aria-label="parserçš„ä½¿ç”¨">parserçš„ä½¿ç”¨</a></li>
                        <li>
                            <a href="#traverse%e7%9a%84%e4%bd%bf%e7%94%a8" aria-label="traverseçš„ä½¿ç”¨">traverseçš„ä½¿ç”¨</a><ul>
                                    
                        <li>
                            <a href="#path%e7%9a%84%e5%b1%9e%e6%80%a7" aria-label="pathçš„å±æ€§">pathçš„å±æ€§</a></li>
                        <li>
                            <a href="#path%e6%96%b9%e6%b3%95" aria-label="pathæ–¹æ³•">pathæ–¹æ³•</a></li></ul>
                        </li>
                        <li>
                            <a href="#fs%e5%af%bc%e5%87%ba%e4%b8%8e%e8%af%bb%e5%8f%96%e6%96%87%e4%bb%b6" aria-label="fså¯¼å‡ºä¸è¯»å–æ–‡ä»¶">fså¯¼å‡ºä¸è¯»å–æ–‡ä»¶</a>
                        </li>
                    </ul>
                    </li>
                    </ul>
                    </li>
                    </ul>
                    </li>
                    </ul>
                </div>
            </details>
        </div>
    </aside>
    <script>
        let activeElement;
        let elements;
        window.addEventListener('DOMContentLoaded', function (event) {
            checkTocPosition();

            elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
            
            activeElement = elements[0];
            const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
            document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
        }, false);

        window.addEventListener('resize', function (event) {
            checkTocPosition();
        }, false);

        window.addEventListener('scroll', () => {
            
            activeElement = Array.from(elements).find((element) => {
                if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                    (getOffsetTop(element) - window.pageYOffset) < window.innerHeight / 2) {
                    return element;
                }
            }) || activeElement

            elements.forEach(element => {
                const id = encodeURI(element.getAttribute('id')).toLowerCase();
                if (element === activeElement) {
                    document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
                } else {
                    document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
                }
            })
        }, false);

        const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
        const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
        const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

        function checkTocPosition() {
            const width = document.body.scrollWidth;

            if (width - main - (toc * 2) - (gap * 4) > 0) {
                document.getElementById("toc-container").classList.add("wide");
            } else {
                document.getElementById("toc-container").classList.remove("wide");
            }
        }

        function getOffsetTop(element) {
            if (!element.getClientRects().length) {
                return 0;
            }
            let rect = element.getBoundingClientRect();
            let win = element.ownerDocument.defaultView;
            return rect.top + win.pageYOffset;
        }
    </script>
  <div class="post-content"><h1 id="astæŠ€æœ¯">astæŠ€æœ¯<a hidden class="anchor" aria-hidden="true" href="#astæŠ€æœ¯">#</a></h1>
<p>astæŠ€æœ¯å¯¹çˆ¬è™«å·¥ç¨‹å¸ˆæ¥è¯´åªæ˜¯ä¸€ç§è¾…åŠ©å·¥å…·ï¼Œå¹¶ä¸èƒ½å¸®æˆ‘ä»¬æ‰¾åˆ°æ ¸å¿ƒçš„ä»£ç ï¼Œä½†èƒ½å¤Ÿæé«˜æˆ‘ä»¬æ‰£æ··æ·†jsçš„æ•ˆç‡ï¼Œæé«˜ä»£ç å¯è¯»æ€§ã€‚</p>
<p>åœ¨ç¼–è¯‘åŸç†ä¸­ï¼Œç¼–è¯‘å™¨è½¬æ¢ä»£ç é€šå¸¸è¦ç»è¿‡ä¸‰ä¸ªæ­¥éª¤ï¼šè¯æ³•åˆ†æï¼ˆLexical Analysisï¼‰ã€è¯­æ³•åˆ†æï¼ˆSyntax Analysisï¼‰ã€ä»£ç ç”Ÿæˆï¼ˆCode Generationï¼‰</p>
<p>å­¦ä¹ astä¸»è¦å°±æ˜¯åˆ¤æ–­èŠ‚ç‚¹ï¼Œå†™æ¡ä»¶ï¼Œè¿˜åŸä»£ç </p>
<h2 id="astçš„å®šä¹‰">astçš„å®šä¹‰<a hidden class="anchor" aria-hidden="true" href="#astçš„å®šä¹‰">#</a></h2>
<p>ast(Absctact Syntax Tree)ï¼Œè¯‘ä¸ºæŠ½è±¡è¯­æ³•æ ‘ã€‚ä¸ºæºä»£ç çš„æŠ½è±¡è¯­æ³•ç»“æ„çš„æ ‘çŠ¶è¡¨ç¤ºï¼Œæ ‘ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¡¨ç¤ºæºä»£ç ä¸­çš„ä¸€ç§ç»“æ„ï¼Œè¿™ç§æ•°æ®ç»“æ„å¯ä»¥ç±»åˆ«ä¸ºä¸€ä¸ªå¤§çš„<code>JSON</code>å¯¹è±¡ã€‚é€šè¿‡ <code>AST</code> æŠ€æœ¯ï¼Œæˆ‘ä»¬é¢å¯¹çš„å°±ä¸å†æ˜¯å„ç§ç¬¦å·æ··æ‚ç©ºæ ¼è€Œæˆçš„æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ä¸€ä¸ªä¸¥è°¨è§„èŒƒçš„æ ‘å½¢ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹ <code>AST </code>æ ‘èŠ‚ç‚¹çš„ä¸€ç³»åˆ—æ“ä½œï¼Œå€ŸåŠ©æœºå™¨é«˜æ•ˆä¸”ç²¾å‡†åœ°ä¿®æ”¹ä»£ç ã€‚</p>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">ä¸‹é¢ä¸¤æ®µjsä»£ç ç­‰ä»·ï¼Œç›¸å½“äºä»&#39;sm-crypto&#39;ä¸­è¯»å–sm2æ¨¡å—
const sm2 = require(&#39;sm-crypto&#39;).sm2
const {sm2} = require(&#39;sm-crypto&#39;)
</code></pre></td></tr></table>
</div>
</div><h2 id="ast-çš„ç”¨é€”">AST çš„ç”¨é€”<a hidden class="anchor" aria-hidden="true" href="#ast-çš„ç”¨é€”">#</a></h2>
<p>IDE çš„è¯­æ³•é«˜äº®ã€ä»£ç æ£€æŸ¥ã€æ ¼å¼åŒ–ã€å‹ç¼©ã€è½¬è¯‘ç­‰ã€‚å°† ES6è½¬åŒ–æˆES5å®ç°è¯­æ³•å…¼å®¹</p>
<h2 id="astæ’ä»¶çš„èµ„æº">ASTæ’ä»¶çš„èµ„æº<a hidden class="anchor" aria-hidden="true" href="#astæ’ä»¶çš„èµ„æº">#</a></h2>
<ol>
<li>
<p>Astexplorer.netï¼šä¸€ä¸ªåœ¨çº¿çš„ASTæµè§ˆå™¨å’Œç¼–è¾‘å™¨ï¼Œå¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿåˆ›å»ºå’Œè°ƒè¯•ASTæ’ä»¶ã€‚</p>
</li>
<li>
<p>Esprimaå’ŒBabelï¼šè¿™ä¸¤ä¸ªå·¥å…·æ˜¯ç”¨äºJavaScriptçš„è§£æå™¨å’Œè½¬è¯‘å™¨ï¼Œå¯ä»¥å¸®åŠ©ä½ æ„å»ºJavaScript ASTæ’ä»¶ã€‚</p>
</li>
<li>
<p>Pythonçš„astæ¨¡å—ï¼šPythonå†…ç½®çš„astæ¨¡å—æä¾›äº†ä¸€ç»„å·¥å…·æ¥å¤„ç†Pythonä»£ç çš„ASTï¼Œå¯ä»¥å¸®åŠ©ä½ æ„å»ºPython ASTæ’ä»¶ã€‚</p>
</li>
<li>
<p>LLVMï¼šä¸€ä¸ªå¼€æºçš„ç¼–è¯‘å™¨åŸºç¡€è®¾æ–½ï¼Œæä¾›äº†è®¸å¤šåº“å’Œå·¥å…·æ¥å¤„ç†ASTå’ŒIRï¼Œå¯ä»¥å¸®åŠ©ä½ æ„å»ºC++ç­‰è¯­è¨€çš„ASTæ’ä»¶ã€‚</p>
</li>
<li>
<p>å­¦ä¹ astå‚è€ƒåœ°å€ï¼šhttps://evilrecluse.top/Babel-traverse-api-doc/#/</p>
</li>
</ol>
<h2 id="è§£æ··æ·†apiå­¦ä¹ ">è§£æ··æ·†APIå­¦ä¹ <a hidden class="anchor" aria-hidden="true" href="#è§£æ··æ·†apiå­¦ä¹ ">#</a></h2>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#2c5dcd;font-weight:bold">var</span> a <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#34;\u0068\u0065\u006c\u006c\u006f\u002c\u0041\u0053\u0054&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>1. type:  è¡¨ç¤ºå½“å‰èŠ‚ç‚¹çš„ç±»å‹ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„ç±»å‹åˆ¤æ–­æ–¹æ³• t.is *<em>*</em>**(node),å°±æ˜¯åˆ¤æ–­å½“å‰çš„èŠ‚ç‚¹æ˜¯å¦ä¸ºæŸä¸ªç±»å‹ã€‚</strong></p>
<p><strong>2. start: è¡¨ç¤ºå½“å‰èŠ‚ç‚¹çš„èµ·å§‹ä½ã€‚</strong></p>
<p><strong>3. end:  è¡¨ç¤ºå½“å‰èŠ‚ç‚¹çš„æœ«å°¾ã€‚</strong></p>
<p><strong>4. loc :  è¡¨ç¤ºå½“å‰èŠ‚ç‚¹æ‰€åœ¨çš„è¡Œåˆ—ä½ç½®ï¼Œé‡Œé¢ä¹Ÿæœ‰startä¸endèŠ‚ç‚¹ï¼Œè¿™é‡Œçš„startä¸ä¸Šé¢çš„startæ˜¯ä¸åŒçš„ï¼Œè¿™é‡Œçš„startæ˜¯è¡¨ç¤ºèŠ‚ç‚¹æ‰€åœ¨èµ·å§‹çš„è¡Œåˆ—ä½ã€‚ç½®ï¼Œè€Œendè¡¨ç¤ºçš„æ˜¯èŠ‚ç‚¹æ‰€åœ¨æœ«å°¾çš„è¡Œåˆ—ä½ç½®ã€‚</strong></p>
<p><strong>5. errors:æ˜¯FileèŠ‚ç‚¹æ‰€ç‰¹æœ‰çš„å±æ€§ï¼Œå¯ä»¥ä¸ç”¨ç†ä¼šã€‚</strong></p>
<p><strong>6. program:åŒ…å«æ•´ä¸ªæºä»£ç ï¼Œä¸åŒ…å«æ³¨é‡ŠèŠ‚ç‚¹ã€‚</strong></p>
<p><strong>7. comments:æºä»£ç ä¸­æ‰€æœ‰çš„æ³¨é‡Šä¼šåœ¨è¿™é‡Œæ˜¾ç¤ºã€‚</strong></p>
<h3 id="å„ç§å¸¸è§çš„èŠ‚ç‚¹ç±»å‹">å„ç§å¸¸è§çš„èŠ‚ç‚¹ç±»å‹<a hidden class="anchor" aria-hidden="true" href="#å„ç§å¸¸è§çš„èŠ‚ç‚¹ç±»å‹">#</a></h3>
<p><img loading="lazy" src="https://cdn.staticaly.com/gh/hanson00/img@master/ast01.png" alt="image-20230318072614156"  />
</p>
<h3 id="fsåº“å¯ä»¥è§£å†³jsçš„æ–‡ä»¶è¯»å†™é—®é¢˜">fsåº“å¯ä»¥è§£å†³jsçš„æ–‡ä»¶è¯»å†™é—®é¢˜<a hidden class="anchor" aria-hidden="true" href="#fsåº“å¯ä»¥è§£å†³jsçš„æ–‡ä»¶è¯»å†™é—®é¢˜">#</a></h3>
<p>è¯»å–æ–‡ä»¶</p>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">xx <span style="color:#2c5dcd">=</span> _fs.readFileSync(<span style="color:#0c6">&#39;test.js&#39;</span>,{encoding<span style="color:#2c5dcd">:</span><span style="color:#0c6">&#39;utf-8&#39;</span>})
</code></pre></td></tr></table>
</div>
</div><p>å†™å…¥æ–‡ä»¶</p>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">fs.writeFile(<span style="color:#0c6">&#39;decode.js&#39;</span>, code, (err)=&gt;{});
</code></pre></td></tr></table>
</div>
</div><h3 id="å®‰è£…babelåº“">å®‰è£…babelåº“<a hidden class="anchor" aria-hidden="true" href="#å®‰è£…babelåº“">#</a></h3>
<ol>
<li><code>@babel/core</code>ï¼šBabel ç¼–è¯‘å™¨æœ¬èº«ï¼Œæä¾›äº† babel çš„ç¼–è¯‘ APIï¼›</li>
<li><code>@babel/parser</code>ï¼šå°† JavaScript ä»£ç <strong>è§£ææˆ AST è¯­æ³•æ ‘</strong>ï¼›</li>
<li><code>@babel/traverse</code>ï¼š<strong>éå†ã€ä¿®æ”¹</strong> AST è¯­æ³•æ ‘çš„<strong>å„ä¸ªèŠ‚ç‚¹</strong>ï¼›</li>
<li><code>@babel/generator</code>ï¼šå°† AST <strong>è¿˜åŸæˆ JavaScript ä»£ç </strong>ï¼›</li>
<li><code>@babel/types</code>ï¼š<strong>åˆ¤æ–­ã€éªŒè¯èŠ‚ç‚¹çš„ç±»å‹</strong>ã€æ„å»ºæ–° AST èŠ‚ç‚¹ç­‰ã€‚</li>
</ol>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">npm install <span style="color:#fff;background-color:#c00">@</span>babel<span style="color:#2c5dcd">/</span>core <span style="color:#2c5dcd">--</span>save<span style="color:#2c5dcd">-</span>dev
</code></pre></td></tr></table>
</div>
</div><h3 id="å°è¯•ç‰›åˆ€">å°è¯•ç‰›åˆ€<a hidden class="anchor" aria-hidden="true" href="#å°è¯•ç‰›åˆ€">#</a></h3>
<h4 id="parserçš„ä½¿ç”¨">parserçš„ä½¿ç”¨<a hidden class="anchor" aria-hidden="true" href="#parserçš„ä½¿ç”¨">#</a></h4>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#2c5dcd;font-weight:bold">const</span> parse <span style="color:#2c5dcd">=</span> require(<span style="color:#0c6">&#39;@babel/parser&#39;</span>)

js_code <span style="color:#2c5dcd">=</span> <span style="color:#0c6">`var a = &#34;\u0068\u0065\u006c\u006c\u006f\u002c\u0041\u0053\u0054&#34;`</span>

<span style="color:#2c5dcd;font-weight:bold">let</span> astTree <span style="color:#2c5dcd">=</span> parse.parse(js_code)
console.log(JSON.stringify(astTree, <span style="color:#2c5dcd;font-weight:bold">null</span>, <span style="color:#0c6">&#39;\t&#39;</span>))
</code></pre></td></tr></table>
</div>
</div><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<p>å’Œastè§£æ··æ·†ç½‘ç«™è¾“å‡ºçš„ç»“æœç›¸åŒ</p>
<p><img loading="lazy" src="https://cdn.staticaly.com/gh/hanson00/img@master/ast02.png" alt="image-20230318074226276"  />
</p>
<p><img loading="lazy" src="https://cdn.staticaly.com/gh/hanson00/img@master/ast03.png" alt="image-20230318074246668"  />
</p>
<p><img loading="lazy" src="https://cdn.staticaly.com/gh/hanson00/img@master/ast04.png" alt="image-20230318074307354"  />
</p>
<h4 id="traverseçš„ä½¿ç”¨">traverseçš„ä½¿ç”¨<a hidden class="anchor" aria-hidden="true" href="#traverseçš„ä½¿ç”¨">#</a></h4>
<p>traverseè´Ÿè´£ç¼–å†™æ’ä»¶è¿˜åŸJavaScript</p>
<h5 id="pathçš„å±æ€§">pathçš„å±æ€§<a hidden class="anchor" aria-hidden="true" href="#pathçš„å±æ€§">#</a></h5>
<p><code>path.node</code>:è¡¨ç¤ºå½“å‰pathä¸‹çš„nodeèŠ‚ç‚¹</p>
<p><code>path.toString()</code>:å½“å‰è·¯å¾„æ‰€å¯¹åº”çš„æºä»£ç </p>
<p><code>path.parentPath</code>:ç”¨äºè·å–å½“å‰pathä¸‹çš„çˆ¶pathï¼Œå¤šç”¨äºåˆ¤æ–­èŠ‚ç‚¹ç±»å‹</p>
<p><code>path.container</code>:ç”¨äºè·å–å½“å‰pathä¸‹çš„æ‰€æœ‰å…„å¼ŸèŠ‚ç‚¹(åŒ…æ‹¬è‡ªèº«)</p>
<p><code>path.type</code>:è·å–å½“å‰èŠ‚ç‚¹ç±»å‹</p>
<p><code>path.get('')</code>:è·å–pathçš„å­è·¯å¾„</p>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#2c5dcd;font-weight:bold">const</span> parse <span style="color:#2c5dcd">=</span> require(<span style="color:#0c6">&#39;@babel/parser&#39;</span>)
<span style="color:#0080ff;font-style:italic">//è´Ÿè´£ç¼–å†™è§£æ··æ·†æ’ä»¶
</span><span style="color:#0080ff;font-style:italic"></span><span style="color:#2c5dcd;font-weight:bold">const</span> traverse <span style="color:#2c5dcd">=</span> require(<span style="color:#0c6">&#39;@babel/traverse&#39;</span>).<span style="color:#2c5dcd;font-weight:bold">default</span>
<span style="color:#2c5dcd;font-weight:bold">const</span> generator <span style="color:#2c5dcd">=</span> require(<span style="color:#0c6">&#39;@babel/generator&#39;</span>).<span style="color:#2c5dcd;font-weight:bold">default</span>

js_code <span style="color:#2c5dcd">=</span> <span style="color:#0c6">`var a = &#34;\u0068\u0065\u006c\u006c\u006f\u002c\u0041\u0053\u0054&#34;`</span>
<span style="color:#2c5dcd;font-weight:bold">let</span> astTree <span style="color:#2c5dcd">=</span> parse.parse(js_code)

<span style="color:#0080ff;font-style:italic">// ç¼–å†™æ’ä»¶ï¼Œè¿˜åŸJavaScript
</span><span style="color:#0080ff;font-style:italic">// traverse(astTree, {
</span><span style="color:#0080ff;font-style:italic">//     VariableDeclaration(path){
</span><span style="color:#0080ff;font-style:italic">//         //  path.node  è¡¨ç¤ºå½“å‰èŠ‚ç‚¹
</span><span style="color:#0080ff;font-style:italic">//         console.log(path.node)
</span><span style="color:#0080ff;font-style:italic">//
</span><span style="color:#0080ff;font-style:italic">//         // path.type è·å–å½“å‰èŠ‚ç‚¹çš„ç±»å‹
</span><span style="color:#0080ff;font-style:italic">//         // console.log(path.type)
</span><span style="color:#0080ff;font-style:italic">//
</span><span style="color:#0080ff;font-style:italic">//         //path.toString() è·å–æºä»£ç 
</span><span style="color:#0080ff;font-style:italic">//         console.log(path.toString())
</span><span style="color:#0080ff;font-style:italic">//
</span><span style="color:#0080ff;font-style:italic">//         //ä¸‹é¢ä¸¤ä¸ªè¯­å¥ä½œç”¨ç›¸åŒ
</span><span style="color:#0080ff;font-style:italic">//         console.log(path.parent)
</span><span style="color:#0080ff;font-style:italic">//         // console.log(path.parentPath.node)
</span><span style="color:#0080ff;font-style:italic">//         // console.log(&#39;-------------------------------&#39;)
</span><span style="color:#0080ff;font-style:italic">//         // .get()æ‰¾ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
</span><span style="color:#0080ff;font-style:italic">//         // console.log(path.get(&#39;declarations&#39;)
</span><span style="color:#0080ff;font-style:italic">//     }
</span><span style="color:#0080ff;font-style:italic">// })
</span><span style="color:#0080ff;font-style:italic"></span>
<span style="color:#0080ff;font-style:italic">//å¤„ç†ç¼–ç 
</span><span style="color:#0080ff;font-style:italic"></span>plug <span style="color:#2c5dcd">=</span> {
    StringLiteral(path){
        path.node.extra.raw <span style="color:#2c5dcd">=</span> path.node.extra.rawValue
    }
}
traverse(astTree, plug)

<span style="color:#0080ff;font-style:italic">// traverse(astTree, {
</span><span style="color:#0080ff;font-style:italic">//     Identifier(path){
</span><span style="color:#0080ff;font-style:italic">//         console.log(path.node.name)
</span><span style="color:#0080ff;font-style:italic">//     }
</span><span style="color:#0080ff;font-style:italic">// })
</span><span style="color:#0080ff;font-style:italic">//
</span><span style="color:#0080ff;font-style:italic">// traverse(astTree, {
</span><span style="color:#0080ff;font-style:italic">//     StringLiteral(path){
</span><span style="color:#0080ff;font-style:italic">//         console.log(path.node.value)
</span><span style="color:#0080ff;font-style:italic">//
</span><span style="color:#0080ff;font-style:italic">//     }
</span><span style="color:#0080ff;font-style:italic">// })
</span><span style="color:#0080ff;font-style:italic"></span>
<span style="color:#2c5dcd;font-weight:bold">let</span> {code} <span style="color:#2c5dcd">=</span> generator(astTree)
console.log(code)
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#2c5dcd;font-weight:bold">const</span> parse <span style="color:#2c5dcd">=</span> require(<span style="color:#0c6">&#39;@babel/parser&#39;</span>)
<span style="color:#2c5dcd;font-weight:bold">const</span> traverse <span style="color:#2c5dcd">=</span> require(<span style="color:#0c6">&#39;@babel/traverse&#39;</span>).<span style="color:#2c5dcd;font-weight:bold">default</span>
<span style="color:#2c5dcd;font-weight:bold">const</span> generator <span style="color:#2c5dcd">=</span> require(<span style="color:#0c6">&#39;@babel/generator&#39;</span>).<span style="color:#2c5dcd;font-weight:bold">default</span>
js_code <span style="color:#2c5dcd">=</span> <span style="color:#0c6">`var a = &#34;\u0068\u0065\u006c\u006c\u006f\u002c\u0041\u0053\u0054&#34;`</span>
<span style="color:#2c5dcd;font-weight:bold">let</span> astTree <span style="color:#2c5dcd">=</span> parse.parse(js_code)


<span style="color:#2c5dcd;font-weight:bold">let</span> code1 <span style="color:#2c5dcd">=</span> generator(astTree)
console.log(code1)

<span style="color:#0080ff;font-style:italic">// `@babel/generator`ï¼šå°† AST è¿˜åŸæˆ JavaScript ä»£ç 
</span><span style="color:#0080ff;font-style:italic">// {code}æ˜¯ä»è¿˜åŸçš„ä»£ç ä¸­è·å–JavaScriptæºä»£ç ï¼Œè¿è¡Œä»£ç å¯ä»¥è‡ªå·±çœ‹çœ‹
</span><span style="color:#0080ff;font-style:italic"></span><span style="color:#2c5dcd;font-weight:bold">let</span> {code} <span style="color:#2c5dcd">=</span> generator(astTree)
console.log(<span style="color:#0c6">&#39;-------------------&#39;</span>)
console.log(code)
</code></pre></td></tr></table>
</div>
</div><h5 id="pathæ–¹æ³•">pathæ–¹æ³•<a hidden class="anchor" aria-hidden="true" href="#pathæ–¹æ³•">#</a></h5>
<p><code>path.replaceWith</code>:(å•)èŠ‚ç‚¹æ›¿æ¢å‡½æ•°</p>
<p><code>replaceWithMultiple </code>å¤šèŠ‚ç‚¹æ›¿æ¢å‡½æ•°ï¼Œè°ƒç”¨æ–¹å¼:</p>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">path.replaceWithMultiple(ArrayNode);
</code></pre></td></tr></table>
</div>
</div><p><code>replaceWithMultiple</code> æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ªèŠ‚ç‚¹æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªæ•°ç»„ä¸­çš„èŠ‚ç‚¹ä¼šè¢«æ›¿æ¢å½“å‰çš„èŠ‚ç‚¹ã€‚è¿™äº›æ–°èŠ‚ç‚¹å¯ä»¥æ˜¯ä»»ä½•åˆæ³•çš„ AST èŠ‚ç‚¹ï¼Œä¾‹å¦‚è¡¨è¾¾å¼ã€è¯­å¥ã€å£°æ˜ç­‰</p>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">path.replaceWith(newNode);
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#2c5dcd">!</span>(<span style="color:#2c5dcd;font-weight:bold">function</span> () {
    console.log(<span style="color:#0c6">&#39;66666&#39;</span>)
})
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#0080ff;font-style:italic">// è¿˜åŸå‡½æ•°
</span><span style="color:#0080ff;font-style:italic"></span>traverse(astTree, {
    UnaryExpression(path) {
        <span style="color:#2c5dcd;font-weight:bold">let</span> {argument} <span style="color:#2c5dcd">=</span> path.node
        <span style="color:#2c5dcd;font-weight:bold">if</span> (<span style="color:#2c5dcd">!</span>types.isFunctionExpression(argument)) {
            <span style="color:#2c5dcd;font-weight:bold">return</span>
        }
        <span style="color:#2c5dcd;font-weight:bold">let</span> {body, id, params} <span style="color:#2c5dcd">=</span> argument
        <span style="color:#2c5dcd;font-weight:bold">if</span> (id <span style="color:#2c5dcd">!=</span> <span style="color:#2c5dcd;font-weight:bold">null</span> <span style="color:#2c5dcd">||</span> params.length <span style="color:#2c5dcd">!=</span> <span style="color:#5918bb;font-weight:bold">0</span>) {
            <span style="color:#2c5dcd;font-weight:bold">return</span>
        }
        <span style="color:#0080ff;font-style:italic">//`replaceWithMultiple `å¤šèŠ‚ç‚¹æ›¿æ¢å‡½æ•°ï¼Œè°ƒç”¨æ–¹å¼:
</span><span style="color:#0080ff;font-style:italic"></span>        path.replaceWithMultiple(body.body);
    }
})
</code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="https://cdn.staticaly.com/gh/hanson00/img@master/202303210737237.png" alt="image-20230321073732082"  />
</p>
<p><strong>evaluate()æ–¹æ³•å­¦ä¹ </strong></p>
<p>é’ˆå¯¹ä½œç”¨åŸŸå’Œå¼•ç”¨ï¼Œç›´æ¥ä¾æ®å¼•ç”¨æ¥è®¡ç®—å‡ºæ‰§è¡Œç»“æœã€‚</p>
<p>ä¾‹å­ï¼š<code>navigator[&quot;\x75\x73&quot;+&quot;\x65\x72&quot;+&quot;\x41\x67&quot;+&quot;\x65\x6e&quot;+&quot;\x74&quot;]</code></p>
<p>ä¾‹å­2ï¼š</p>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#2c5dcd;font-weight:bold">function</span> _xl(){
	x <span style="color:#2c5dcd">=</span> <span style="color:#5918bb;font-weight:bold">1</span> <span style="color:#2c5dcd">+</span> <span style="color:#5918bb;font-weight:bold">2</span> <span style="color:#2c5dcd">+</span> <span style="color:#5918bb;font-weight:bold">3</span> <span style="color:#2c5dcd">+</span><span style="color:#5918bb;font-weight:bold">4</span> <span style="color:#2c5dcd">+</span> <span style="color:#5918bb;font-weight:bold">5</span> <span style="color:#2c5dcd">+</span> <span style="color:#5918bb;font-weight:bold">6</span> <span style="color:#2c5dcd">+</span> <span style="color:#5918bb;font-weight:bold">7</span>
}
</code></pre></td></tr></table>
</div>
</div><p>æ’ä»¶ç¼–å†™</p>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">visitor2 <span style="color:#2c5dcd">=</span> {
    <span style="color:#0c6">&#34;BinaryExpression|Identifier&#34;</span>(path){
        <span style="color:#2c5dcd;font-weight:bold">const</span> {confident,value} <span style="color:#2c5dcd">=</span> path.evaluate();
        confident <span style="color:#2c5dcd">&amp;&amp;</span> path.replaceInline(types.valueToNode(value))
    }
}
traverse(_ast,visitor2)
</code></pre></td></tr></table>
</div>
</div><p><strong>ç¼–ç ç±»å‹è¿˜åŸ</strong></p>
<p>å¤„ç†å‰:</p>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#2c5dcd;font-weight:bold">var</span> a <span style="color:#2c5dcd">=</span> <span style="color:#5918bb;font-weight:bold">0x25</span>,b <span style="color:#2c5dcd">=</span> <span style="color:#5918bb;font-weight:bold">0b10001001</span>,c <span style="color:#2c5dcd">=</span> <span style="color:#5918bb;font-weight:bold">0o123456</span>,
d <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#34;\x68\x65\x6c\x6c\x6f\x2c\x41\x53\x54&#34;</span>,
e <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#34;\u0068\u0065\u006c\u006c\u006f\u002c\u0041\u0053\u0054&#34;</span>;
</code></pre></td></tr></table>
</div>
</div><p>å¤„ç†å:</p>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#2c5dcd;font-weight:bold">var</span> a <span style="color:#2c5dcd">=</span> <span style="color:#5918bb;font-weight:bold">37</span>,b <span style="color:#2c5dcd">=</span> <span style="color:#5918bb;font-weight:bold">137</span>,c <span style="color:#2c5dcd">=</span> <span style="color:#5918bb;font-weight:bold">42798</span>,d <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#34;hello,AST&#34;</span>,e <span style="color:#2c5dcd">=</span> <span style="color:#0c6">&#34;hello,AST&#34;</span>;
</code></pre></td></tr></table>
</div>
</div><p>æ’ä»¶ç¼–å†™:</p>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#2c5dcd;font-weight:bold">const</span> transform_literal <span style="color:#2c5dcd">=</span> {
  NumericLiteral({node}) {
    <span style="color:#2c5dcd;font-weight:bold">if</span> (node.extra <span style="color:#2c5dcd">&amp;&amp;</span> <span style="color:#0c6">/^0[obx]/i</span>.test(node.extra.raw)) {
      node.extra <span style="color:#2c5dcd">=</span> <span style="color:#2c5dcd;font-weight:bold">undefined</span>;
    }
  },
  StringLiteral({node}) 
  {
    <span style="color:#2c5dcd;font-weight:bold">if</span> (node.extra <span style="color:#2c5dcd">&amp;&amp;</span> <span style="color:#0c6">/\\[ux]/gi</span>.test(node.extra.raw)) {
      node.extra <span style="color:#2c5dcd">=</span> <span style="color:#2c5dcd;font-weight:bold">undefined</span>;
    }
  },
}
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>é€šç”¨æ’ä»¶</p>
</blockquote>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#2c5dcd;font-weight:bold">const</span> constantFold <span style="color:#2c5dcd">=</span> {
    <span style="color:#0c6">&#34;BinaryExpression|UnaryExpression|ConditionalExpression&#34;</span>(path) {
        <span style="color:#0080ff;font-style:italic">// é˜²æ­¢æº¢å‡º
</span><span style="color:#0080ff;font-style:italic"></span>        <span style="color:#2c5dcd;font-weight:bold">if</span>(path.isUnaryExpression({operator<span style="color:#2c5dcd">:</span><span style="color:#0c6">&#34;-&#34;</span>}) <span style="color:#2c5dcd">||</span>
    	   path.isUnaryExpression({operator<span style="color:#2c5dcd">:</span><span style="color:#0c6">&#34;void&#34;</span>}))
    	{
    		<span style="color:#2c5dcd;font-weight:bold">return</span>;
    	}
        <span style="color:#2c5dcd;font-weight:bold">const</span> {confident, value} <span style="color:#2c5dcd">=</span> path.evaluate();
        <span style="color:#2c5dcd;font-weight:bold">if</span> (<span style="color:#2c5dcd">!</span>confident)
            <span style="color:#2c5dcd;font-weight:bold">return</span>;
        <span style="color:#2c5dcd;font-weight:bold">if</span> (<span style="color:#2c5dcd;font-weight:bold">typeof</span> value <span style="color:#2c5dcd">==</span> <span style="color:#0c6">&#39;number&#39;</span> <span style="color:#2c5dcd">&amp;&amp;</span> (<span style="color:#2c5dcd">!</span><span style="color:#5918bb;font-weight:bold">Number</span>.<span style="color:#5918bb;font-weight:bold">isFinite</span>(value))) {
            <span style="color:#2c5dcd;font-weight:bold">return</span>;
        }
        path.replaceWith(types.valueToNode(value));
    },
}
traverse(_ast, constantFold);
</code></pre></td></tr></table>
</div>
</div><h4 id="fså¯¼å‡ºä¸è¯»å–æ–‡ä»¶">fså¯¼å‡ºä¸è¯»å–æ–‡ä»¶<a hidden class="anchor" aria-hidden="true" href="#fså¯¼å‡ºä¸è¯»å–æ–‡ä»¶">#</a></h4>
<p>è¯»å–æ–‡ä»¶</p>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">gy <span style="color:#2c5dcd">=</span> _fs.readFileSync(<span style="color:#0c6">&#39;test.js&#39;</span>,{encoding<span style="color:#2c5dcd">:</span><span style="color:#0c6">&#39;utf-8&#39;</span>})
</code></pre></td></tr></table>
</div>
</div><p>å†™å…¥æ–‡ä»¶</p>
<div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">fs.writeFile(<span style="color:#0c6">&#39;decode.js&#39;</span>, code, (err)=&gt;{});
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#2c5dcd;font-weight:bold">const</span> parse <span style="color:#2c5dcd">=</span> require(<span style="color:#0c6">&#39;@babel/parser&#39;</span>)
<span style="color:#2c5dcd;font-weight:bold">const</span> traverse <span style="color:#2c5dcd">=</span> require(<span style="color:#0c6">&#39;@babel/traverse&#39;</span>).<span style="color:#2c5dcd;font-weight:bold">default</span>
<span style="color:#2c5dcd;font-weight:bold">const</span> generator <span style="color:#2c5dcd">=</span> require(<span style="color:#0c6">&#39;@babel/generator&#39;</span>).<span style="color:#2c5dcd;font-weight:bold">default</span>
<span style="color:#2c5dcd;font-weight:bold">const</span> fs <span style="color:#2c5dcd">=</span> require(<span style="color:#0c6">&#39;fs&#39;</span>)
<span style="color:#2c5dcd;font-weight:bold">const</span> types <span style="color:#2c5dcd">=</span> require(<span style="color:#0c6">&#39;@babel/types&#39;</span>)


js_code <span style="color:#2c5dcd">=</span> fs.readFileSync(<span style="color:#0c6">&#39;encode.js&#39;</span>, {encoding<span style="color:#2c5dcd">:</span> <span style="color:#0c6">&#39;utf-8&#39;</span>})
<span style="color:#2c5dcd;font-weight:bold">let</span> astTree <span style="color:#2c5dcd">=</span> parse.parse(js_code)

<span style="color:#0080ff;font-style:italic">// å¤„ç†ç¼–ç 
</span><span style="color:#0080ff;font-style:italic">// å˜é‡èµ‹å€¼è¿˜åŸ
</span><span style="color:#0080ff;font-style:italic"></span>traverse(astTree, {
    <span style="color:#0080ff;font-style:italic">// å˜é‡èµ‹å€¼è¿˜åŸ
</span><span style="color:#0080ff;font-style:italic"></span>    StringLiteral(path) {
        path.node.extra.raw <span style="color:#2c5dcd">=</span> path.node.rawValue
    }
})

<span style="color:#0080ff;font-style:italic">// + æ‹¼æ¥è¿˜åŸ
</span><span style="color:#0080ff;font-style:italic"></span>traverse(astTree, {
    <span style="color:#0080ff;font-style:italic">// + æ‹¼æ¥è¿˜åŸ
</span><span style="color:#0080ff;font-style:italic"></span>    BinaryExpression(path) {
        <span style="color:#2c5dcd;font-weight:bold">let</span> {left, operator, right} <span style="color:#2c5dcd">=</span> path.node;
        <span style="color:#0080ff;font-style:italic">// console.log(left)
</span><span style="color:#0080ff;font-style:italic"></span>        <span style="color:#0080ff;font-style:italic">// console.log(left.value)
</span><span style="color:#0080ff;font-style:italic"></span>        <span style="color:#2c5dcd;font-weight:bold">if</span> (types.isNumericLiteral(left) <span style="color:#2c5dcd">&amp;&amp;</span> types.isNumericLiteral(right) <span style="color:#2c5dcd">&amp;&amp;</span> operator <span style="color:#2c5dcd">==</span> <span style="color:#0c6">&#34;+&#34;</span>) {
            value <span style="color:#2c5dcd">=</span> left.value <span style="color:#2c5dcd">+</span> right.value

            path.replaceWith(types.valueToNode(value))  <span style="color:#0080ff;font-style:italic">// è¿›è¡Œæ–¹æ³•æ›¿æ¢
</span><span style="color:#0080ff;font-style:italic"></span>        }

        <span style="color:#2c5dcd;font-weight:bold">if</span> (types.isStringLiteral(left) <span style="color:#2c5dcd">&amp;&amp;</span> types.isStringLiteral(right) <span style="color:#2c5dcd">&amp;&amp;</span> operator <span style="color:#2c5dcd">==</span> <span style="color:#0c6">&#39;+&#39;</span>) {
            <span style="color:#2c5dcd;font-weight:bold">let</span> value <span style="color:#2c5dcd">=</span> left.value <span style="color:#2c5dcd">+</span> right.value
            path.replaceWith(types.valueToNode(value))
        }
    }
})

<span style="color:#0080ff;font-style:italic">// è¿˜åŸå‡½æ•°
</span><span style="color:#0080ff;font-style:italic"></span>traverse(astTree, {
    UnaryExpression(path) {
        <span style="color:#2c5dcd;font-weight:bold">let</span> {argument} <span style="color:#2c5dcd">=</span> path.node
        <span style="color:#2c5dcd;font-weight:bold">if</span> (<span style="color:#2c5dcd">!</span>types.isFunctionExpression(argument)) {
            <span style="color:#2c5dcd;font-weight:bold">return</span>
        }
        <span style="color:#2c5dcd;font-weight:bold">let</span> {body, id, params} <span style="color:#2c5dcd">=</span> argument
        <span style="color:#2c5dcd;font-weight:bold">if</span> (id <span style="color:#2c5dcd">!=</span> <span style="color:#2c5dcd;font-weight:bold">null</span> <span style="color:#2c5dcd">||</span> params.length <span style="color:#2c5dcd">!=</span> <span style="color:#5918bb;font-weight:bold">0</span>) {
            <span style="color:#2c5dcd;font-weight:bold">return</span>
        }
        <span style="color:#0080ff;font-style:italic">//`replaceWithMultiple `å¤šèŠ‚ç‚¹æ›¿æ¢å‡½æ•°ï¼Œè°ƒç”¨æ–¹å¼:
</span><span style="color:#0080ff;font-style:italic"></span>        path.replaceWithMultiple(body.body);
    }
})

<span style="color:#0080ff;font-style:italic">// è¿˜åŸå¸¦æ‹¬å·çš„è‡ªæ‰§è¡Œæ–¹æ³•
</span><span style="color:#0080ff;font-style:italic"></span>traverse(astTree, {
    UnaryExpression(path) {
        <span style="color:#2c5dcd;font-weight:bold">let</span> {argument} <span style="color:#2c5dcd">=</span> path.node
        <span style="color:#0080ff;font-style:italic">// console.log(argument)
</span><span style="color:#0080ff;font-style:italic"></span>        <span style="color:#2c5dcd;font-weight:bold">if</span> (<span style="color:#2c5dcd">!</span>types.isCallExpression(argument)) {
            <span style="color:#2c5dcd;font-weight:bold">return</span>
        }
        <span style="color:#0080ff;font-style:italic">// console.log(argument.callee)
</span><span style="color:#0080ff;font-style:italic"></span>        <span style="color:#2c5dcd;font-weight:bold">let</span> {body, id, params} <span style="color:#2c5dcd">=</span> argument.callee
        <span style="color:#2c5dcd;font-weight:bold">if</span> (id <span style="color:#2c5dcd">!=</span> <span style="color:#2c5dcd;font-weight:bold">null</span> <span style="color:#2c5dcd">||</span> params.length <span style="color:#2c5dcd">!=</span> <span style="color:#5918bb;font-weight:bold">0</span>) {
            <span style="color:#2c5dcd;font-weight:bold">return</span>
        }
        <span style="color:#0080ff;font-style:italic">//`replaceWithMultiple `å¤šèŠ‚ç‚¹æ›¿æ¢å‡½æ•°ï¼Œè°ƒç”¨æ–¹å¼:
</span><span style="color:#0080ff;font-style:italic"></span>        path.replaceWithMultiple(body.body);
    }
})

<span style="color:#0080ff;font-style:italic">// è¿˜åŸvar arr =  &#39;3,4,0,5,1,2&#39;[&#39;split&#39;](&#39;,&#39;)ä»£ç æœ‰é—®é¢˜
</span><span style="color:#0080ff;font-style:italic">// traverse(astTree, {
</span><span style="color:#0080ff;font-style:italic">//     CallExpression(path){
</span><span style="color:#0080ff;font-style:italic">//         let {callee,arguments} = path.node
</span><span style="color:#0080ff;font-style:italic">//         // objectæ˜¯åˆ—è¡¨çš„å€¼
</span><span style="color:#0080ff;font-style:italic">//         let object = callee.object.value;
</span><span style="color:#0080ff;font-style:italic">//         // console.log(object)
</span><span style="color:#0080ff;font-style:italic">//
</span><span style="color:#0080ff;font-style:italic">//         //propertyæ˜¯æ–¹æ³•split
</span><span style="color:#0080ff;font-style:italic">//         let property = callee.property.value;
</span><span style="color:#0080ff;font-style:italic">//         // console.log(property)
</span><span style="color:#0080ff;font-style:italic">//         // é€—å·
</span><span style="color:#0080ff;font-style:italic">//         let argument = arguments[0].value;
</span><span style="color:#0080ff;font-style:italic">//         // console.log(argument)
</span><span style="color:#0080ff;font-style:italic">//
</span><span style="color:#0080ff;font-style:italic">//          //æ¨¡æ‹Ÿæ‰§è¡Œæ–¹æ³•
</span><span style="color:#0080ff;font-style:italic">//          array = property[object](argument)
</span><span style="color:#0080ff;font-style:italic">//          path.replaceWithMultiple(types.valueToNode(array))
</span><span style="color:#0080ff;font-style:italic">//     }
</span><span style="color:#0080ff;font-style:italic">// })
</span><span style="color:#0080ff;font-style:italic"></span>
<span style="color:#0080ff;font-style:italic">// è®¡ç®—ç»“æœæ‹¼æ¥ é’ˆå¯¹ä½œç”¨åŸŸå’Œå¼•ç”¨ï¼Œç›´æ¥ä¾æ®å¼•ç”¨æ¥è®¡ç®—å‡ºæ‰§è¡Œç»“æœã€‚
</span><span style="color:#0080ff;font-style:italic"></span>traverse(astTree, {
     <span style="color:#0c6">&#34;BinaryExpression|Identifier&#34;</span>(path){
        <span style="color:#2c5dcd;font-weight:bold">const</span> {confident,value} <span style="color:#2c5dcd">=</span> path.evaluate();
        confident <span style="color:#2c5dcd">&amp;&amp;</span> path.replaceInline(types.valueToNode(value))
    }
})


<span style="color:#0080ff;font-style:italic">//é€šç”¨æ’ä»¶
</span><span style="color:#0080ff;font-style:italic"></span><span style="color:#2c5dcd;font-weight:bold">const</span> constantFold <span style="color:#2c5dcd">=</span> {
    <span style="color:#0c6">&#34;BinaryExpression|UnaryExpression|ConditionalExpression&#34;</span>(path) {
        <span style="color:#0080ff;font-style:italic">// é˜²æ­¢æº¢å‡º
</span><span style="color:#0080ff;font-style:italic"></span>        <span style="color:#2c5dcd;font-weight:bold">if</span>(path.isUnaryExpression({operator<span style="color:#2c5dcd">:</span><span style="color:#0c6">&#34;-&#34;</span>}) <span style="color:#2c5dcd">||</span>
          path.isUnaryExpression({operator<span style="color:#2c5dcd">:</span><span style="color:#0c6">&#34;void&#34;</span>}))
       {
          <span style="color:#2c5dcd;font-weight:bold">return</span>;
       }
        <span style="color:#2c5dcd;font-weight:bold">const</span> {confident, value} <span style="color:#2c5dcd">=</span> path.evaluate();
        <span style="color:#2c5dcd;font-weight:bold">if</span> (<span style="color:#2c5dcd">!</span>confident)
            <span style="color:#2c5dcd;font-weight:bold">return</span>;
        <span style="color:#2c5dcd;font-weight:bold">if</span> (<span style="color:#2c5dcd;font-weight:bold">typeof</span> value <span style="color:#2c5dcd">==</span> <span style="color:#0c6">&#39;number&#39;</span> <span style="color:#2c5dcd">&amp;&amp;</span> (<span style="color:#2c5dcd">!</span><span style="color:#5918bb;font-weight:bold">Number</span>.<span style="color:#5918bb;font-weight:bold">isFinite</span>(value))) {
            <span style="color:#2c5dcd;font-weight:bold">return</span>;
        }
        path.replaceWith(types.valueToNode(value));
    },
}
traverse(astTree, constantFold);

<span style="color:#0080ff;font-style:italic">// ç¼–ç ç±»å‹è¿˜åŸï¼Œå¤„ç†ç¼–ç å’Œè¿›åˆ¶æ’ä»¶
</span><span style="color:#0080ff;font-style:italic"></span><span style="color:#2c5dcd;font-weight:bold">const</span> transform_literal <span style="color:#2c5dcd">=</span> {
  NumericLiteral({node}) {
    <span style="color:#2c5dcd;font-weight:bold">if</span> (node.extra <span style="color:#2c5dcd">&amp;&amp;</span> <span style="color:#0c6">/^0[obx]/i</span>.test(node.extra.raw)) {
      node.extra <span style="color:#2c5dcd">=</span> <span style="color:#2c5dcd;font-weight:bold">undefined</span>;
    }
  },
  StringLiteral({node})
  {
    <span style="color:#2c5dcd;font-weight:bold">if</span> (node.extra <span style="color:#2c5dcd">&amp;&amp;</span> <span style="color:#0c6">/\\[ux]/gi</span>.test(node.extra.raw)) {
      node.extra <span style="color:#2c5dcd">=</span> <span style="color:#2c5dcd;font-weight:bold">undefined</span>;
    }
  },
}
traverse(astTree, transform_literal);

<span style="color:#2c5dcd;font-weight:bold">let</span> {code} <span style="color:#2c5dcd">=</span> generator(astTree)
console.log(<span style="color:#0c6">&#39;--------------------------&#39;</span>)
console.log(code)

fs.writeFile(<span style="color:#0c6">&#39;decode.js&#39;</span>, code, (err) =&gt; {
});
</code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://hanson00.github.io/tags/js%E9%80%86%E5%90%91/">jsé€†å‘</a></li>
      <li><a href="https://hanson00.github.io/tags/%E7%88%AC%E8%99%AB/">çˆ¬è™«</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://hanson00.github.io/posts/technology/js%E9%80%86%E5%90%91/%E8%A1%A5%E7%8E%AF%E5%A2%8301/">
    <span class="title">Â« Prev</span>
    <br>
    <span>è¡¥ç¯å¢ƒ01</span>
  </a>
  <a class="next" href="https://hanson00.github.io/posts/technology/js%E9%80%86%E5%90%91/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0rpc/">
    <span class="title">Next Â»</span>
    <br>
    <span>é€†å‘å­¦ä¹ RPC</span>
  </a>
</nav>

  </footer>
<div>
    <div class="pagination__title">
        <span class="pagination__title-h" style="font-size: 20px;">ğŸ’¬è¯„è®º</span>âœ¨æ˜µç§°è¾“å…¥QQå·å¯ä»¥è‡ªåŠ¨å…³è”âœ¨
        <hr />

    </div>
    <div id="tcomment"></div>
    <script src="https://cdn.staticfile.org/twikoo/1.5.11/twikoo.all.min.js"></script>
    <script>
        twikoo.init({
            envId: "https://twikoo1-mu.vercel.app/",  
            el: "#tcomment",
            lang: 'zh-CN',
            region: 'ap-guangzhou',  
            path: window.TWIKOO_MAGIC_PATH || window.location.pathname,
        });
    </script>
</div>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://hanson00.github.io/">Hanson&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
